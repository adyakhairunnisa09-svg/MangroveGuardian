html
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Mangrove Guardian - EVI Cipasilin 2020</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>

    <style>
        /* ==================== VARIABLES & RESET ==================== */
        :root {
            --mg-green: #0a5c36;
            --mg-green-light: #1a7d4e;
            --mg-green-dark: #064527;
            --panel: rgba(255, 255, 255, 0.95);
            --muted: #51606a;
            --sidebar-width: 240px; /* Lebar Sidebar Baru */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: #15302a;
        }

        body {
            background: #f8f9fa;
        }

        /* ==================== SIDEBAR STYLES (NEW) ==================== */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background-color: var(--mg-green);
            color: white;
            padding: 15px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 1500;
        }

        .brand {
            padding: 10px 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .brand span {
            font-size: 1.5em;
            font-weight: bold;
        }

        .nav-menu {
            flex-grow: 1;
            overflow-y: auto;
        }

        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            border-radius: 4px;
            transition: background-color 0.3s;
            font-size: 14px;
        }

        .nav-menu a:hover {
            background-color: var(--mg-green-light);
        }

        #dropdownContent {
            display: none;
            padding-left: 5px;
        }

        .dropdown-toggle.active-toggle,
        .submenu-toggle.active-toggle {
            background-color: var(--mg-green-light);
            font-weight: bold;
        }

        .dropdown-submenu-content {
            display: none;
            padding-left: 15px;
            border-left: 2px solid rgba(255, 255, 255, 0.3);
            margin-left: 5px;
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .dropdown-submenu-content a {
            font-size: 0.9em;
            padding: 8px 10px;
            opacity: 0.8;
        }

        .dropdown-submenu-content a:hover {
            opacity: 1;
            background-color: #1c9264;
        }

        .lang-switch {
            cursor: pointer;
            border: 1px solid white;
            padding: 8px 10px;
            text-align: center;
            border-radius: 4px;
            margin-top: auto;
            transition: background-color 0.3s;
            font-size: 14px;
        }

        .lang-switch:hover {
            background-color: var(--mg-green-light);
        }
        
        /* ==================== APP LAYOUT (ADJUSTED FOR SIDEBAR) ==================== */
        .app {
            height: 100vh;
            margin-left: var(--sidebar-width); /* Beri ruang untuk sidebar */
            position: relative;
            display: flex;
        }
        
        #map {
            flex: 1;
            z-index: 1;
        }

        /* ==================== MAP CONTROLS & PANELS (OLD CSS ADAPTED) ==================== */

        .chat-box-container{
          position:fixed;
          bottom:20px;
          right:20px;
          z-index:1600;
          width:350px;
          background:var(--panel);
          border-radius:8px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.15);
          border:1px solid #e1e5e9;
          display:flex;
          flex-direction:column;
          max-height:500px;
        }
        
        .chat-header{
          background: var(--mg-green);
          color: #fff;
          padding: 12px 16px;
          font-weight: 600;
          cursor:pointer;
          display:flex;
          justify-content:space-between;
          align-items:center;
          border-radius:8px 8px 0 0;
        }
        
        .chat-content{
          padding: 16px;
          flex:1;
          overflow-y: auto;
          display:flex;
          flex-direction:column;
          gap:12px;
          max-height:300px;
        }
        
        .chat-input-row{
          display:flex;
          gap:8px;
          padding:12px 16px;
          border-top:1px solid #e1e5e9;
          background:#f8f9fa;
        }
        
        .chat-input-row input{
          flex:1;
          padding:10px 12px;
          border-radius:6px;
          border:1px solid #ddd;
          outline:none;
          font-size:14px;
          background:#fff;
        }
        
        .chat-input-row button{
          background:var(--mg-green);
          border:0;
          color:#fff;
          padding:10px 16px;
          border-radius:6px;
          cursor:pointer;
          font-weight:600;
          font-size:14px;
        }

        .chat-message{
          padding:10px 14px;
          border-radius:8px;
          max-width:85%;
          font-size:14px;
          line-height:1.4;
        }
        
        .chat-user{
          background:#e3f2fd;
          align-self:flex-end;
          border-bottom-right-radius:2px;
        }
        
        .chat-bot{
          background:#f5f5f5;
          align-self:flex-start;
          border-bottom-left-radius:2px;
        }

        .search-row-container{
          position:absolute;
          top:20px;
          left:50%;
          transform:translateX(-50%);
          z-index:1300;
          display:flex;
          flex-direction:column;
          align-items:center;
          gap:8px;
          width:90%;
          max-width:700px;
        }
        
        .search-row{
          display:flex;
          align-items:center;
          gap:8px;
          width:100%;
        }
        
        .search-box{
          display:flex;
          align-items:center;
          background:var(--panel);
          padding:8px 16px;
          border-radius:8px;
          box-shadow:0 2px 8px rgba(0,0,0,0.1);
          width:100%;
          border:1px solid #e1e5e9;
          flex:1;
        }
        
        .search-box input{
          border:0;
          outline:none;
          padding:8px;
          font-size:14px;
          background:transparent;
          flex:1;
        }
        
        .search-box button{
          background:var(--mg-green);
          border:0;
          color:#fff;
          padding:8px 16px;
          border-radius:6px;
          cursor:pointer;
          font-weight:600;
          font-size:14px;
        }
        
        .action-btn{
          background:var(--mg-green);
          color:#fff;
          border-radius:8px;
          padding:10px 16px;
          border:none;
          cursor:pointer;
          font-weight:600;
          font-size:14px;
          white-space:nowrap;
        }
        
        .mapFlipBtn{
          background:var(--mg-green);
          border:none;
          padding:10px;
          border-radius:6px;
          color:white;
          cursor:pointer;
          font-size:16px;
        }

        .stats-toggle-btn {
          background:var(--mg-green);
          border:none;
          padding:10px 14px;
          border-radius:6px;
          color:white;
          cursor:pointer;
          font-size:16px;
          display:flex;
          align-items:center;
          justify-content:center;
          box-shadow:0 2px 6px rgba(0,0,0,0.1);
          transition:all 0.3s ease;
          white-space: nowrap;
        }

        .stats-toggle-btn:hover {
          background:var(--mg-green-light);
          transform: translateY(-1px);
        }

        .vtoolbar{
          position:absolute;
          left:20px;
          top:120px;
          z-index:1300;
          display:flex;
          flex-direction:column;
          gap:8px;
          padding:8px;
          border-radius:8px;
          background:transparent;
        }
        
        .vt-btn{
          width:44px;
          height:44px;
          border-radius:6px;
          background:var(--panel);
          display:flex;
          align-items:center;
          justify-content:center;
          border:1px solid #e1e5e9;
          box-shadow:0 2px 6px rgba(0,0,0,0.08);
          cursor:pointer;
          font-size:16px;
          transition:all 0.2s;
        }
        
        .vt-btn:hover{
          background:#f8f9fa;
        }

        .right-panel{
          position:absolute;
          right:20px;
          top:20px;
          width:320px;
          z-index:1300;
          background:var(--panel);
          border-radius:8px;
          box-shadow:0 4px 20px rgba(0,0,0,0.15);
          border:1px solid #e1e5e9;
          max-height:calc(100vh - 40px); /* 100vh - (top:20px + bottom:20px) */
          overflow-y:auto;
        }
        
        .panel-inner{
          padding:16px;
        }
        
        .panel-header{
          display:flex;
          align-items:center;
          justify-content:space-between;
          margin-bottom:16px;
          padding-bottom:12px;
          border-bottom:1px solid #e1e5e9;
        }
        
        .panel-header h3{
          margin:0;
          color:var(--mg-green);
          font-size:16px;
          font-weight:600;
        }

        .switch-row{
          display:flex;
          align-items:center;
          justify-content:space-between;
          padding:12px 0;
          border-bottom:1px solid #f0f0f0;
        }
        
        .switch-label{
          font-size:14px;
          color:#333;
        }
        
        .switch{
          position:relative;
          width:44px;
          height:24px;
          border-radius:12px;
          background:#ddd;
          cursor:pointer;
        }
        
        .switch .knob{
          position:absolute;
          top:2px;
          left:2px;
          width:20px;
          height:20px;
          border-radius:50%;
          background:white;
          box-shadow:0 1px 3px rgba(0,0,0,0.2);
          transition:left 0.2s;
        }
        
        .switch.on{
          background:var(--mg-green);
        }
        
        .switch.on .knob{
          left:22px;
        }

        .basemap-toggle{
          position:absolute;
          right:20px;
          top:70px;
          z-index:1350;
        }
        
        .basemap-card{
          width:250px;
          background:var(--panel);
          border-radius:8px;
          padding:12px;
          box-shadow:0 4px 20px rgba(0,0,0,0.15);
          border:1px solid #e1e5e9;
        }
        
        .basemap-card.hidden{
          display:none;
        }
        
        .basemap-item{
          padding:10px;
          border-radius:6px;
          margin-bottom:6px;
          cursor:pointer;
          font-size:14px;
          border:1px solid transparent;
        }
        
        .basemap-item:hover{
          background:#f8f9fa;
        }
        
        .basemap-item.active{
          background:#e8f5e8;
          border-color:var(--mg-green);
        }

        .scale-box{
          position:absolute;
          left:20px;
          bottom:20px;
          background:var(--panel);
          padding:8px 12px;
          border-radius:6px;
          font-size:12px;
          border:1px solid #e1e5e9;
          z-index:1300;
          box-shadow:0 2px 4px rgba(0,0,0,0.1);
        }

        .class-item{
          display:flex;
          align-items:center;
          gap:10px;
          padding:10px 0;
          border-bottom:1px solid #f0f0f0;
        }
        
        .class-color{
          width:16px;
          height:16px;
          border-radius:3px;
        }
        
        .class-label{
          flex:1;
          font-size:13px;
        }

        .file-upload{
          margin-top:16px;
          padding:12px;
          border:2px dashed #ddd;
          border-radius:6px;
          text-align:center;
          cursor:pointer;
          transition:border-color 0.2s;
        }
        
        .file-upload:hover{
          border-color:var(--mg-green);
        }
        
        .file-hint{
          font-size:12px;
          color:var(--muted);
          margin-top:8px;
          text-align:center;
        }

        .vt-btn.active-draw{
          background:var(--mg-green);
          color:#fff;
        }
        
        .vt-btn.delete-active{
          background:#dc3545;
          color:#fff;
        }

        @media (max-width:768px){
          .sidebar{
            width: 100%;
            height: 60px;
            overflow: hidden;
            position: fixed;
            top: 0;
            left: 0;
            flex-direction: row;
            justify-content: space-between;
          }
          .app{
            margin-left: 0;
            height: calc(100vh - 60px);
            margin-top: 60px;
          }
          .brand{display: none;} /* Sembunyikan brand di mobile */
          .nav-menu{display:none}
          .lang-switch{display:none;}
          .search-row{flex-wrap:wrap;}
          .right-panel{width:95%; right:2.5%;}
          .chat-box-container{width:95%; right:2.5%;}
          .stats-panel{width:95%; left:2.5%; top: 80px; /* Di bawah sidebar mobile */ }
          .stats-toggle-btn{display:none;}
          .vtoolbar{top: 80px;}
        }

        .analysis-section {
          margin: 16px 0;
          padding: 12px;
          background: #f8f9fa;
          border-radius: 6px;
        }
        
        .pulau-selector {
          margin-bottom: 12px;
        }
        
        .pulau-selector select {
          width: 100%;
          padding: 8px;
          border-radius: 4px;
          border: 1px solid #ddd;
        }
        
        .data-display {
          background: white;
          padding: 12px;
          border-radius: 4px;
          margin-top: 8px;
        }
        
        .data-item {
          display: flex;
          justify-content: space-between;
          margin-bottom: 6px;
          font-size: 13px;
        }
        
        .data-value {
          font-weight: 600;
          color: var(--mg-green);
        }

        .custom-tooltip {
          background: rgba(255, 255, 255, 0.95) !important;
          border: 1px solid #0a5c36 !important;
          border-radius: 4px !important;
          padding: 4px 8px !important;
          font-size: 12px !important;
          font-weight: 500 !important;
        }

        .legend {
          background: white;
          padding: 10px;
          border-radius: 5px;
          box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        
        .legend h4 {
          margin: 0 0 8px 0;
        }

        .stats-panel {
          position: absolute;
          left: 80px;
          top: 120px;
          z-index: 1300;
          background: var(--panel);
          padding: 15px;
          border-radius: 8px;
          box-shadow: 0 4px 20px rgba(0,0,0,0.15);
          border: 1px solid #e1e5e9;
          width: 300px;
          max-height: 75vh;
          overflow-y: auto;
          transition: all 0.3s ease;
        }

        .stats-panel.hidden {
            display: none;
        }

        .stats-header {
          font-weight: 600;
          color: var(--mg-green);
          margin-bottom: 12px;
          font-size: 16px;
          border-bottom: 2px solid var(--mg-green);
          padding-bottom: 8px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .stats-close {
          background: none;
          border: none;
          font-size: 18px;
          cursor: pointer;
          color: var(--muted);
          padding: 0;
          width: 24px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .stats-close:hover {
          color: var(--mg-green);
        }

        .stat-item {
          display: flex;
          justify-content: space-between;
          margin-bottom: 8px;
          font-size: 13px;
          padding: 6px 0;
          border-bottom: 1px solid #f0f0f0;
        }

        .stat-item:last-child {
          border-bottom: none;
        }

        .stat-value {
          font-weight: 600;
          color: var(--mg-green);
        }

        .chart-container {
          margin-top: 15px;
          height: 200px;
          position: relative;
        }

        .download-btn {
          background: var(--mg-green);
          color: white;
          border: none;
          padding: 10px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
          font-weight: 600;
          margin-top: 15px;
          width: 100%;
          transition: background 0.3s ease;
        }

        .download-btn:hover {
          background: var(--mg-green-light);
        }

        .collapsible {
          margin-top: 10px;
        }

        .collapsible-header {
          background: #f8f9fa;
          padding: 10px;
          border-radius: 6px;
          cursor: pointer;
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-weight: 600;
          font-size: 13px;
          color: var(--mg-green);
        }

        .collapsible-content {
          padding: 10px;
          background: white;
          border-radius: 0 0 6px 6px;
          margin-top: 2px;
        }

        .collapsible.hidden .collapsible-content {
          display: none;
        }

        /* Progress Bar untuk Loading */
        .progress-bar {
          width: 100%;
          height: 4px;
          background: #f0f0f0;
          border-radius: 2px;
          overflow: hidden;
          margin: 10px 0;
        }

        .progress-fill {
          height: 100%;
          background: var(--mg-green);
          transition: width 0.3s ease;
        }

        /* Filter Controls */
        .filter-controls {
          margin: 15px 0;
          padding: 12px;
          background: #f8f9fa;
          border-radius: 6px;
        }

        .filter-title {
          font-weight: 600;
          margin-bottom: 10px;
          color: var(--mg-green);
        }

        .filter-buttons {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
        }

        .filter-btn {
          padding: 6px 12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          background: white;
          cursor: pointer;
          font-size: 12px;
          transition: all 0.2s;
        }

        .filter-btn.active {
          background: var(--mg-green);
          color: white;
          border-color: var(--mg-green);
        }

        .filter-btn:hover {
          background: #e9ecef;
        }

        .filter-btn.active:hover {
          background: var(--mg-green-light);
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">
            <span>üåø MangroveGuardian</span>
        </div>

        <div class="nav-menu">
            <a href="index.html" data-key="home">Beranda</a>

            <div class="dropdown">
                <a href="javascript:void(0)" id="dropdownToggle" data-key="data-mangrove" class="dropdown-toggle active-link">Data Mangrove</a>
                
                <div class="dropdown-content" id="dropdownContent" style="display: block;">

                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Pulau Panjang</a>
                        <div class="dropdown-submenu-content">
                            <a href="evipanjang20.html">EVI 2020</a>
                            <a href="evipanjang21.html">EVI 2021</a>
                            <a href="evipanjang22.html">EVI 2022</a>
                            <a href="evipanjang23.html">EVI 2023</a>
                            <a href="evipanjang24.html">EVI 2024</a>
                            <hr style="margin: 5px 0; border: 0; border-top: 1px solid #eee;">
                            <a href="savipanjang20.html">SAVI 2020</a>
                            <a href="savipanjang21.html">SAVI 2021</a>
                            <a href="savipanjang22.html">SAVI 2022</a>
                            <a href="savipanjang23.html">SAVI 2023</a>
                            <a href="savipanjang24.html">SAVI 2024</a>
                        </div>
                    </div>

                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle active-toggle">Cipasilin</a>
                        <div class="dropdown-submenu-content" style="display: block;">
                            <a href="evicipasilin20.html" class="active-link">EVI 2020</a>
                            <a href="evicipasilin21.html">EVI 2021</a>
                            <a href="evicipasilin22.html">EVI 2022</a>
                            <a href="evicipasilin23.html">EVI 2023</a>
                            <a href="evicipasilin24.html">EVI 2024</a>
                            <hr style="margin: 5px 0; border: 0; border-top: 1px solid #eee;">
                            <a href="savicipasilin20.html">SAVI 2020</a>
                            <a href="savicipasilin21.html">SAVI 2021</a>
                            <a href="savicipasilin22.html">SAVI 2022</a>
                            <a href="savicipasilin23.html">SAVI 2023</a>
                            <a href="savicipasilin24.html">SAVI 2024</a>
                        </div>
                    </div>

                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Karangantu</a>
                        <div class="dropdown-submenu-content">
                            <a href="evikarangantu20.html">EVI 2020</a>
                            <a href="evikarangantu21.html">EVI 2021</a>
                            <a href="evikarangantu22.html">EVI 2022</a>
                            <a href="evikarangantu23.html">EVI 2023</a>
                            <a href="evikarangantu24.html">EVI 2024</a>
                        </div>
                    </div>

                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Pulau Tunda</a>
                        <div class="dropdown-submenu-content">
                            <a href="savitunda20.html">SAVI 2020</a>
                            <a href="savitunda21.html">SAVI 2021</a>
                            <a href="savitunda22.html">SAVI 2022</a>
                            <a href="savitunda23.html">SAVI 2023</a>
                            <a href="savitunda24.html">SAVI 2024</a>
                        </div>
                    </div>

                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Kasemen</a>
                        <div class="dropdown-submenu-content">
                            <a href="savikasemen20.html">SAVI 2020</a>
                            <a href="savikasemen21.html">SAVI 2021</a>
                            <a href="savikasemen22.html">SAVI 2022</a>
                            <a href="savikasemen23.html">SAVI 2023</a>
                            <a href="savikasemen24.html">SAVI 2024</a>
                        </div>
                    </div>

                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Kronjo</a>
                        <div class="dropdown-submenu-content">
                            <a href="savikronjo20.html">SAVI 2020</a>
                            <a href="savikronjo21.html">SAVI 2021</a>
                            <a href="savikronjo22.html">SAVI 2022</a>
                            <a href="savikronjo23.html">SAVI 2023</a>
                        </div>
                    </div>

                    <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Potang</a>
                        <div class="dropdown-submenu-content">
                            <a href="savipotang20.html">SAVI 2020</a>
                            <a href="savipotang22.html">SAVI 2022</a>
                            <a href="savipotang23.html">SAVI 2023</a>
                            <a href="savipotang24.html">SAVI 2024</a>
                        </div>
                    </div>

                  <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Pulau Sangiang</a>
                        <div class="dropdown-submenu-content">
                            <a href="savipotang20.html">SAVI 2020</a>
                            <a href="savipotang22.html">SAVI 2022</a>
                            <a href="savipotang23.html">SAVI 2023</a>
                            <a href="savipotang24.html">SAVI 2024</a>
                        </div>
                    </div>
                    
                  <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">tirtayasa</a>
                        <div class="dropdown-submenu-content">
                            <a href="savitirtayasa20.html">SAVI 2020</a>
                            <a href="savitirtayasa21.html">SAVI 2021</a>
                            <a href="savititayasa22.html">SAVI 2022</a>
                            <a href="savitirtayasa23.html">SAVI 2023</a>
                            <a href="savitirtayasa24.html">SAVI 2024</a>
                        </div>
                    </div>

                     <div class="dropdown-submenu">
                        <a href="javascript:void(0)" class="submenu-toggle">Barat</a>
                        <div class="dropdown-submenu-content">
                            <a href="savibarat20.html">SAVI 2020</a>
                            <a href="savibarat21.html">SAVI 2021</a>
                            <a href="savibarat22.html">SAVI 2022</a>
                            <a href="savibarat23.html">SAVI 2023</a>
                            <a href="savibarat24.html">SAVI 2024</a>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <div class="lang-switch" id="langSwitch">ID / EN</div>
    </div>
    
    <div class="app">
        <div id="map"></div>

        <div class="search-row-container">
            <div class="search-row">
                <button class="stats-toggle-btn" id="statsToggle" title="Toggle Panel Statistik">
                    üìä Statistik
                </button>

                <div class="search-box">
                    <input id="searchInput" placeholder="Cari lokasi atau koordinat (contoh: -6.037,106.444)..." />
                    <button id="doSearch">Cari</button>
                </div>

                <button class="action-btn" id="addPointBtn">+ Titik Baru</button>
                <button id="basemapFlipBtn" class="mapFlipBtn" title="Peta Dasar">üó∫Ô∏è</button>
                <button id="togglePanelBtn" class="mapFlipBtn" title="Panel Layer">‚ò∞</button>
            </div>
        </div>

        <div class="stats-panel hidden" id="statsPanel">
            <div class="stats-header">
                <span>üìä Statistik EVI Cipasilin 2020</span>
                <button class="stats-close" id="statsClose" title="Tutup">‚úï</button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="dataProgress" style="width: 100%"></div>
            </div>
            
            <div class="stat-item">
                <span>Total Luasan:</span>
                <span class="stat-value" id="totalLuas">8.10 ha</span>
            </div>
            <div class="stat-item">
                <span>Jumlah Poligon:</span>
                <span class="stat-value" id="jumlahPoligon">4</span>
            </div>
            <div class="stat-item">
                <span>Kerapatan Rata-rata:</span>
                <span class="stat-value" id="kerapatanRata">2.5</span>
            </div>
            <div class="stat-item">
                <span>Luasan Tertinggi:</span>
                <span class="stat-value" id="luasMax">3.06 ha</span>
            </div>
            <div class="stat-item">
                <span>Luasan Terendah:</span>
                <span class="stat-value" id="luasMin">0.72 ha</span>
            </div>

            <div class="filter-controls">
                <div class="filter-title">Filter Kerapatan:</div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-density="all">Semua</button>
                    <button class="filter-btn" data-density="1">Sangat Rendah</button>
                    <button class="filter-btn" data-density="2">Rendah</button>
                    <button class="filter-btn" data-density="3">Sedang-Rendah</button>
                    <button class="filter-btn" data-density="4">Sedang</button>
                </div>
            </div>

            <div class="collapsible" id="chartCollapsible">
                <div class="collapsible-header" id="chartHeader">
                    <span>üìà Grafik Distribusi</span>
                    <span>‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="chart-container">
                        <canvas id="densityChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="collapsible" id="detailCollapsible">
                <div class="collapsible-header" id="detailHeader">
                    <span>üîç Detail Kerapatan</span>
                    <span>‚ñº</span>
                </div>
                <div class="collapsible-content">
                    <div class="stat-item">
                        <span>Sangat Rendah (1):</span>
                        <span class="stat-value" id="detailSangatRendah">1 poligon</span>
                    </div>
                    <div class="stat-item">
                        <span>Rendah (2):</span>
                        <span class="stat-value" id="detailRendah">1 poligon</span>
                    </div>
                    <div class="stat-item">
                        <span>Sedang-Rendah (3):</span>
                        <span class="stat-value" id="detailSedangRendah">1 poligon</span>
                    </div>
                    <div class="stat-item">
                        <span>Sedang (4):</span>
                        <span class="stat-value" id="detailSedang">1 poligon</span>
                    </div>
                </div>
            </div>

            <button class="download-btn" id="downloadData">
                üì• Download Data GeoJSON
            </button>

            <button class="download-btn" id="screenshot" style="background: #6c757d; margin-top: 8px;">
                üì∑ Screenshot Peta
            </button>
        </div>

        <div class="vtoolbar">
            <div class="vt-btn" id="zoomIn" title="Zoom In">+</div>
            <div class="vt-btn" id="zoomOut" title="Zoom Out">‚àí</div>
            <div class="vt-btn" id="measureBtn" title="Ukur Jarak">üìè</div>
            <div style="border-top:1px solid #eee; margin:6px 0"></div>
            <div class="vt-btn" id="drawPt" title="Titik">‚Ä¢</div>
            <div class="vt-btn" id="drawPoly" title="Poligon">‚ñ≥</div>
            <div class="vt-btn" id="drawRect" title="Persegi">‚ñ°</div>
            <div style="border-top:1px solid #eee; margin:6px 0"></div>
            <div class="vt-btn" id="deleteBtn" title="Hapus">üóëÔ∏è</div>
            <div class="vt-btn" id="printBtn" title="Cetak">üñ®Ô∏è</div>
        </div>

        <div class="scale-box" id="scaleBox">Skala: 1:100,000</div>
        <div class="scale-box" id="measureBox" style="left:120px; display:none; background:#fff3cd; color:#856404;"></div>

        <div class="right-panel hidden" id="rightPanel">
            <div class="panel-inner">
                <div class="panel-header">
                    <h3>Layer & Pengaturan</h3>
                    <button id="closePanel" class="vt-btn" style="width:auto; padding:6px 10px;">‚úï</button>
                </div>

                <div class="analysis-section">
                    <div style="font-weight:600; color:var(--mg-green); margin-bottom:12px;">üìä Data EVI Cipasilin 2020</div>
                    
                    <div class="pulau-selector">
                        <label for="pulauSelect">Pilih Lokasi:</label>
                        <select id="pulauSelect">
                            <option value="cipasilin" selected>Cipasilin</option>
                            </select>
                    </div>

                    <div class="pulau-selector">
                        <label for="tahunSelect">Pilih Tahun:</label>
                        <select id="tahunSelect">
                            <option value="2020" selected>2020</option>
                            </select>
                    </div>

                    <div class="data-display">
                        <div class="data-item">
                            <span>Vegetasi Sangat Rendah:</span>
                            <span class="data-value" id="dataSangatRendah">1 poligon</span>
                        </div>
                        <div class="data-item">
                            <span>Vegetasi Rendah:</span>
                            <span class="data-value" id="dataRendah">1 poligon</span>
                        </div>
                        <div class="data-item">
                            <span>Vegetasi Sedang-Rendah:</span>
                            <span class="data-value" id="dataSedangRendah">1 poligon</span>
                        </div>
                        <div class="data-item">
                            <span>Vegetasi Sedang:</span>
                            <span class="data-value" id="dataSedang">1 poligon</span>
                        </div>
                        <div class="data-item">
                            <span>EVI Rata-rata:</span>
                            <span class="data-value" id="dataEVI">0.35</span>
                        </div>
                    </div>
                </div>

                <div class="switch-row">
                    <div class="switch-label">Layer EVI</div>
                    <div class="switch on" id="rasterSwitch"><div class="knob"></div></div>
                </div>

                <div style="margin:16px 0;">
                    <div style="font-weight:600; color:var(--mg-green); margin-bottom:12px;">Kelas Kerapatan EVI</div>
                    <div id="classesList"></div>
                </div>

                <hr style="margin:16px 0; border:none; border-top:1px solid #e1e5e9;">

                <div style="font-weight:600; color:var(--mg-green); margin-bottom:12px;">Ekspor Data</div>
                <div class="file-upload" id="fileUploadArea">
                    <div>üìÅ Upload File GeoJSON</div>
                    <input type="file" id="fileInput" accept=".json,.geojson" style="display:none" />
                </div>
                <div class="file-hint">Format yang didukung: GeoJSON, JSON</div>

                <button class="download-btn" id="exportReport">
                    üìÑ Export Laporan PDF
                </button>
            </div>
        </div>

        <div class="basemap-toggle">
            <div class="basemap-card hidden" id="basemapCard">
                <div style="font-weight:600; margin-bottom:12px;">Peta Dasar</div>
                <div class="basemap-item active" data-basemap="osm">OpenStreetMap</div>
                <div class="basemap-item" data-basemap="satellite">Satelit</div>
                <div class="basemap-item" data-basemap="terrain">Topografi</div>
            </div>
        </div>
    </div>

    <script>
        // ==================== NAVIGASI SIDEBAR LOGIC (BARU) ====================
        function setupSidebar() {
            // Fungsi utilitas untuk mengaktifkan/menonaktifkan display: none
            function toggleContent(element) {
                if (element.style.display === 'none' || element.style.display === '') {
                    element.style.display = 'block';
                } else {
                    element.style.display = 'none';
                }
            }

            // 1. TOGGLE MENU UTAMA: 'Data Mangrove'
            const mainToggle = document.getElementById('dropdownToggle');
            const mainContent = document.getElementById('dropdownContent');

            if (mainToggle && mainContent) {
                // Biarkan terbuka secara default karena Cipasilin 2020 adalah halaman yang sedang aktif
                // mainContent.style.display = 'block'; 
                mainToggle.classList.add('active-toggle');
                
                mainToggle.addEventListener('click', function() {
                    toggleContent(mainContent);
                    this.classList.toggle('active-toggle');
                });
            }

            // 2. TOGGLE SUB-MENU: 'Pulau Panjang', 'Cipasilin', dll.
            const submenuToggles = document.querySelectorAll('.dropdown-submenu .submenu-toggle');

            submenuToggles.forEach(toggleButton => {
                // Buka submenu Cipasilin secara default
                if (toggleButton.textContent.includes('Cipasilin')) {
                    toggleButton.classList.add('active-toggle');
                    const submenuContent = toggleButton.nextElementSibling;
                    if (submenuContent) {
                        submenuContent.style.display = 'block';
                    }
                }

                toggleButton.addEventListener('click', function() {
                    const submenuContent = this.nextElementSibling;
                    if (submenuContent && submenuContent.classList.contains('dropdown-submenu-content')) {
                        toggleContent(submenuContent);
                        this.classList.toggle('active-toggle');
                    }
                });
            });
        }

        // ==================== PETA & DATA LOGIC (LAMA/LENGKAP) ====================
        
        // Data kelas EVI
        const CLASSES = [
            { label: 'Sangat Rendah (EVI < 0.2)', min: -1, max: 0.2, color: '#fdd0a2', density: 1 },
            { label: 'Rendah (0.2 ‚â§ EVI < 0.3)', min: 0.2, max: 0.3, color: '#fdae6b', density: 2 },
            { label: 'Sedang-Rendah (0.3 ‚â§ EVI < 0.4)', min: 0.3, max: 0.4, color: '#fd8d3c', density: 3 },
            { label: 'Sedang (0.4 ‚â§ EVI < 0.5)', min: 0.4, max: 0.5, color: '#e6550d', density: 4 },
            { label: 'Tinggi (EVI ‚â• 0.5)', min: 0.5, max: 1, color: '#a63603', density: 5 }
        ];

        // Data EVI Cipasilin 2020 yang terpotong - menggunakan data placeholder
        // Perhatian: Koordinat dan data properti ini adalah placeholder, ganti dengan data GeoJSON lengkap Anda.
        const eviCipasilin2020 = {
            "type": "FeatureCollection",
            "features": [
                { "type": "Feature", "properties": { "density": 1, "EVI": 0.15, "Luas_ha": 0.72 }, "geometry": { "type": "Polygon", "coordinates": [[ [106.440, -6.040], [106.442, -6.040], [106.442, -6.042], [106.440, -6.042], [106.440, -6.040] ]] } },
                { "type": "Feature", "properties": { "density": 2, "EVI": 0.25, "Luas_ha": 1.55 }, "geometry": { "type": "Polygon", "coordinates": [[ [106.444, -6.044], [106.446, -6.044], [106.446, -6.046], [106.444, -6.046], [106.444, -6.044] ]] } },
                { "type": "Feature", "properties": { "density": 3, "EVI": 0.35, "Luas_ha": 2.77 }, "geometry": { "type": "Polygon", "coordinates": [[ [106.448, -6.048], [106.450, -6.048], [106.450, -6.050], [106.448, -6.050], [106.448, -6.048] ]] } },
                { "type": "Feature", "properties": { "density": 4, "EVI": 0.45, "Luas_ha": 3.06 }, "geometry": { "type": "Polygon", "coordinates": [[ [106.452, -6.052], [106.454, -6.052], [106.454, -6.054], [106.452, -6.054], [106.452, -6.052] ]] } }
            ]
        };

        let eviLayer;
        let drawnItems;
        let densityChart;

        // Fungsi untuk mendapatkan warna berdasarkan nilai EVI/density
        function getColor(d) {
            const classObj = CLASSES.find(cls => d >= cls.min && d < cls.max) || CLASSES[0];
            return classObj.color;
        }
        
        function styleFeature(feature) {
            const density = feature.properties.density;
            const classObj = CLASSES.find(cls => cls.density === density);
            return {
                fillColor: classObj ? classObj.color : '#ccc',
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        }

        function onEachFeature(feature, layer) {
            const EVI_val = feature.properties.EVI ? feature.properties.EVI.toFixed(3) : 'N/A';
            const luas_val = feature.properties.Luas_ha ? feature.properties.Luas_ha.toFixed(2) + ' ha' : 'N/A';
            const density_val = feature.properties.density;
            const densityLabel = CLASSES.find(cls => cls.density === density_val)?.label || 'Tidak Terdefinisi';

            layer.bindPopup(`
                <b>Lokasi:</b> Cipasilin<br>
                <b>Tahun:</b> 2020<br>
                <b>EVI:</b> ${EVI_val}<br>
                <b>Luas:</b> ${luas_val}<br>
                <b>Kerapatan:</b> ${densityLabel.split('(')[0].trim()} (${density_val})
            `, {className: 'custom-tooltip'});
        }

        function loadGeoJSONData(data = eviCipasilin2020) {
            if (map.hasLayer(eviLayer)) {
                map.removeLayer(eviLayer);
            }
            
            eviLayer = L.geoJson(data, {
                style: styleFeature,
                onEachFeature: onEachFeature
            }).addTo(map);

            // Zoom ke bounds data
            if (eviLayer.getBounds().isValid()) {
                map.fitBounds(eviLayer.getBounds());
            }

            // Update statistik
            updateStats(data.features);
            
            // Inisialisasi Chart
            renderChart(data.features);

            // Sembunyikan progress bar (placeholder)
            document.getElementById('dataProgress').style.width = '100%';
        }
        
        function updateStats(features) {
            const totalLuas = features.reduce((sum, f) => sum + f.properties.Luas_ha, 0);
            const totalPoligon = features.length;
            const avgDensity = features.reduce((sum, f) => sum + f.properties.density, 0) / totalPoligon;
            const luasMax = Math.max(...features.map(f => f.properties.Luas_ha));
            const luasMin = Math.min(...features.map(f => f.properties.Luas_ha));
            const avgEVI = features.reduce((sum, f) => sum + f.properties.EVI, 0) / totalPoligon;

            const counts = features.reduce((acc, f) => {
                acc[f.properties.density] = (acc[f.properties.density] || 0) + 1;
                return acc;
            }, {});

            document.getElementById('totalLuas').textContent = totalLuas.toFixed(2) + ' ha';
            document.getElementById('jumlahPoligon').textContent = totalPoligon;
            document.getElementById('kerapatanRata').textContent = avgDensity.toFixed(1);
            document.getElementById('luasMax').textContent = luasMax.toFixed(2) + ' ha';
            document.getElementById('luasMin').textContent = luasMin.toFixed(2) + ' ha';
            
            // Update Right Panel
            document.getElementById('dataSangatRendah').textContent = (counts[1] || 0) + ' poligon';
            document.getElementById('dataRendah').textContent = (counts[2] || 0) + ' poligon';
            document.getElementById('dataSedangRendah').textContent = (counts[3] || 0) + ' poligon';
            document.getElementById('dataSedang').textContent = (counts[4] || 0) + ' poligon';
            document.getElementById('dataEVI').textContent = avgEVI.toFixed(2);
            
            // Update Detail Stats Panel
            document.getElementById('detailSangatRendah').textContent = (counts[1] || 0) + ' poligon';
            document.getElementById('detailRendah').textContent = (counts[2] || 0) + ' poligon';
            document.getElementById('detailSedangRendah').textContent = (counts[3] || 0) + ' poligon';
            document.getElementById('detailSedang').textContent = (counts[4] || 0) + ' poligon';
        }

        function renderChart(features) {
            const densityCounts = features.reduce((acc, f) => {
                acc[f.properties.density] = (acc[f.properties.density] || 0) + 1;
                return acc;
            }, {});

            const labels = CLASSES.slice(0, 4).map(c => c.label.split('(')[0].trim());
            const data = labels.map((_, index) => densityCounts[index + 1] || 0);
            const colors = CLASSES.slice(0, 4).map(c => c.color);

            if (densityChart) {
                densityChart.destroy();
            }

            const ctx = document.getElementById('densityChart').getContext('2d');
            densityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Jumlah Poligon',
                        data: data,
                        backgroundColor: colors,
                        borderColor: colors.map(c => c.replace('0.7', '1')), // Sedikit lebih gelap
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Jumlah'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Fungsi untuk merender daftar kelas (legenda) di Right Panel
        function renderClasses() {
            const classesList = document.getElementById('classesList');
            classesList.innerHTML = '';
            
            CLASSES.forEach(cls => {
                const item = document.createElement('div');
                item.className = 'class-item';
                item.innerHTML = `
                    <div class="class-color" style="background:${cls.color}"></div>
                    <div class="class-label">${cls.label}</div>
                    <div class="switch on" data-density="${cls.density}"><div class="knob"></div></div>
                `;
                classesList.appendChild(item);
                
                // Switch event
                const switchEl = item.querySelector('.switch');
                switchEl.addEventListener('click', function() {
                    this.classList.toggle('on');
                    filterLayerByClass();
                });
            });
        }
        
        function filterLayerByClass() {
            const activeDensities = [];
            document.querySelectorAll('#classesList .switch.on').forEach(s => {
                activeDensities.push(parseInt(s.getAttribute('data-density')));
            });

            if (eviLayer) {
                eviLayer.eachLayer(function(layer) {
                    const density = layer.feature.properties.density;
                    if (activeDensities.includes(density)) {
                        layer.addTo(map);
                    } else {
                        map.removeLayer(layer);
                    }
                });
            }
        }
        
        // ==================== INISIALISASI PETA & EVENT LISTENER ====================
        const map = L.map('map').setView([-6.037, 106.444], 14);

        // Layer Dasar
        const basemaps = {
            'osm': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }),
            'satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '¬© Esri',
                maxZoom: 19
            }),
            'terrain': L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg', {
                attribution: '¬© Stamen Design'
            })
        };

        let currentBasemap = 'satellite';
        basemaps[currentBasemap].addTo(map);

        document.addEventListener('DOMContentLoaded', function() {
            // Setup Sidebar Navigasi
            setupSidebar();
            
            // Render Kelas Legenda di Panel Kanan
            renderClasses();
            
            // Load data EVI Cipasilin 2020
            loadGeoJSONData();

            // ==================== PANEL & STATS TOGGLES ====================
            const rightPanel = document.getElementById('rightPanel');
            const statsPanel = document.getElementById('statsPanel');
            const basemapCard = document.getElementById('basemapCard');
            
            document.getElementById('togglePanelBtn').addEventListener('click', () => {
                rightPanel.classList.toggle('hidden');
                statsPanel.classList.add('hidden'); // Tutup stats saat layer dibuka
            });
            document.getElementById('closePanel').addEventListener('click', () => {
                rightPanel.classList.add('hidden');
            });
            document.getElementById('statsToggle').addEventListener('click', () => {
                statsPanel.classList.toggle('hidden');
                rightPanel.classList.add('hidden'); // Tutup layer saat stats dibuka
            });
            document.getElementById('statsClose').addEventListener('click', () => {
                statsPanel.classList.add('hidden');
            });

            document.getElementById('basemapFlipBtn').addEventListener('click', () => {
                basemapCard.classList.toggle('hidden');
            });

            // ==================== BASEMAP SWITCH ====================
            document.querySelectorAll('.basemap-item').forEach(item => {
                item.addEventListener('click', function() {
                    const newBasemap = this.getAttribute('data-basemap');
                    if (newBasemap !== currentBasemap) {
                        map.removeLayer(basemaps[currentBasemap]);
                        basemaps[newBasemap].addTo(map);
                        currentBasemap = newBasemap;
                        
                        document.querySelector('.basemap-item.active').classList.remove('active');
                        this.classList.add('active');
                    }
                    basemapCard.classList.add('hidden');
                });
            });

            // ==================== TOOLBAR & DRAWING ====================
            drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);
            
            const drawControl = new L.Control.Draw({
                edit: {
                    featureGroup: drawnItems
                },
                draw: {
                    polygon: false,
                    polyline: false,
                    circle: false,
                    marker: { title: 'Draw Marker' },
                    rectangle: { title: 'Draw Rectangle' }
                }
            });
            
            // Custom draw control activation (simplified)
            document.getElementById('drawPt').addEventListener('click', () => {
                new L.Draw.Marker(map, drawControl.options.draw.marker).enable();
                document.getElementById('drawPt').classList.add('active-draw');
            });
            document.getElementById('drawRect').addEventListener('click', () => {
                new L.Draw.Rectangle(map, drawControl.options.draw.rectangle).enable();
                document.getElementById('drawRect').classList.add('active-draw');
            });
            
            map.on(L.Draw.Event.CREATED, function(e) {
                const type = e.layerType;
                const layer = e.layer;
                drawnItems.addLayer(layer);
                document.querySelectorAll('.vt-btn.active-draw').forEach(btn => btn.classList.remove('active-draw'));
            });

            document.getElementById('deleteBtn').addEventListener('click', () => {
                drawnItems.clearLayers();
            });

            // ==================== ZOOM AND SCALE ====================
            document.getElementById('zoomIn').addEventListener('click', () => { map.zoomIn(); });
            document.getElementById('zoomOut').addEventListener('click', () => { map.zoomOut(); });
            
            map.on('zoomend', function() {
                const zoom = map.getZoom();
                // Formula perkiraan skala (sangat sederhana)
                const scale = Math.round(591657550 / Math.pow(2, zoom - 1));
                document.getElementById('scaleBox').textContent = `Skala: 1:${scale.toLocaleString()}`;
            });

            // ==================== FILTER BUTTONS (STATS PANEL) ====================
            document.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const densityFilter = this.getAttribute('data-density');
                    if (eviLayer) {
                        eviLayer.eachLayer(function(layer) {
                            const density = layer.feature.properties.density.toString();
                            if (densityFilter === 'all' || density === densityFilter) {
                                map.hasLayer(layer) ? null : layer.addTo(map);
                            } else {
                                map.hasLayer(layer) ? map.removeLayer(layer) : null;
                            }
                        });
                    }
                });
            });
            
            // ==================== COLLAPSIBLE SECTIONS ====================
            document.querySelectorAll('.collapsible-header').forEach(header => {
                header.addEventListener('click', function() {
                    this.closest('.collapsible').classList.toggle('hidden');
                    const span = this.querySelector('span:last-child');
                    span.textContent = span.textContent === '‚ñº' ? '‚ñ≤' : '‚ñº';
                });
            });

            // Sembunyikan Detail & Chart secara default
            document.getElementById('detailCollapsible').classList.add('hidden');
            document.getElementById('chartCollapsible').classList.add('hidden');
        });
    </script>
</body>
</html>

```



