<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mangrove Guardian - Savi Desa Tanara 24</title>

  <!-- External Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>

  <!-- Custom Styles -->
  <style>
    :root {
      --mg-green: #0a5c36;
      --mg-green-light: #1a7d4e;
      --mg-green-dark: #064527;
      --panel: rgba(255,255,255,0.95);
      --muted: #51606a;
      --navbar-height: 60px; 
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html, body {
      height: 100%; 
      margin: 0; 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      color: #15302a;
    }
    
    body { background: #f8f9fa; }
    
    .topbar {
      height: var(--navbar-height);
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--mg-green);
      color: #fff;
      position: sticky;
      top: 0;
      z-index: 1500;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .brand {
      font-weight: 600;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .app {
      height: calc(100vh - var(--navbar-height));
      position: relative;
      display: flex;
    }
    
    #map {
      flex: 1;
      z-index: 1;
    }
    
    .search-row-container {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1300;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      width: 90%;
      max-width: 700px;
    }
    
    .search-row {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
    }
    
    .search-box {
      display: flex;
      align-items: center;
      background: var(--panel);
      padding: 8px 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 100%;
      border: 1px solid #e1e5e9;
      flex: 1;
    }
    
    .search-box input {
      border: 0;
      outline: none;
      padding: 8px;
      font-size: 14px;
      background: transparent;
      flex: 1;
    }
    
    .action-btn, .search-box button, .mapFlipBtn {
      background: var(--mg-green);
      border: 0;
      color: #fff;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }
    
    .stats-toggle-btn {
      background: var(--mg-green);
      border: none;
      padding: 10px 14px;
      border-radius: 6px;
      color: white;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      white-space: nowrap;
    }
    
    .stats-panel {
      position: absolute;
      left: 80px;
      top: 120px;
      z-index: 1300;
      background: var(--panel);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border: 1px solid #e1e5e9;
      width: 300px;
      max-height: 75vh;
      overflow-y: auto;
    }
    
    .stats-header {
      font-weight: 600;
      color: var(--mg-green);
      margin-bottom: 12px;
      font-size: 16px;
      border-bottom: 2px solid var(--mg-green);
      padding-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
      padding: 6px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .stat-value {
      font-weight: 600;
      color: var(--mg-green);
    }
    
    .chart-container {
      margin-top: 15px;
      height: 200px;
      position: relative;
    }
    
    .download-btn {
      background: var(--mg-green);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin-top: 15px;
      width: 100%;
    }
    
    .vtoolbar {
      position: absolute;
      left: 20px;
      top: 120px;
      z-index: 1300;
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 8px;
      border-radius: 8px;
      background: transparent;
    }
    
    .vt-btn {
      width: 44px;
      height: 44px;
      border-radius: 6px;
      background: var(--panel);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #e1e5e9;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      cursor: pointer;
      font-size: 16px;
    }
    
    .scale-box {
      position: absolute;
      left: 20px;
      bottom: 20px;
      background: var(--panel);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      border: 1px solid #e1e5e9;
      z-index: 1300;
    }
    
    @media (max-width: 768px) {
      .search-row { flex-wrap: wrap; }
      .stats-panel { width: 95%; left: 2.5%; }
      .stats-toggle-btn { display: none; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="topbar">
    <div class="brand">
      <span>üåø MangroveGuardian - Savi Desa Tanara 24</span>
    </div>
  </div>

  <!-- Main App -->
  <div class="app">
    <div id="map"></div>

    <!-- Search Bar dengan Tombol Statistik -->
    <div class="search-row-container">
      <div class="search-row">
        <!-- Tombol Statistik di sebelah kiri search box -->
        <button class="stats-toggle-btn" id="statsToggle" title="Toggle Panel Statistik">
          üìä Statistik
        </button>

        <!-- Search Box di tengah -->
        <div class="search-box">
          <input id="searchInput" placeholder="Cari lokasi atau koordinat (contoh: -6.007,106.399)..." />
          <button id="doSearch">Cari</button>
        </div>

        <!-- Tombol-tombol lainnya di sebelah kanan -->
        <button class="action-btn" id="addPointBtn">+ Titik Baru</button>
        <button id="basemapFlipBtn" class="mapFlipBtn" title="Peta Dasar">üó∫Ô∏è</button>
      </div>
    </div>

    <!-- Statistics Panel -->
    <div class="stats-panel" id="statsPanel">
      <div class="stats-header">
        <span>üìä Statistik Savi Desa Tanara 24</span>
        <button class="stats-close" id="statsClose" title="Tutup">‚úï</button>
      </div>
      
      <div class="stat-item">
        <span>Total Luasan:</span>
        <span class="stat-value" id="totalLuas">Menghitung...</span>
      </div>
      <div class="stat-item">
        <span>Jumlah Poligon:</span>
        <span class="stat-value" id="jumlahPoligon">38</span>
      </div>
      <div class="stat-item">
        <span>Kerapatan Rata-rata:</span>
        <span class="stat-value" id="kerapatanRata">Menghitung...</span>
      </div>
      <div class="stat-item">
        <span>Luasan Tertinggi:</span>
        <span class="stat-value" id="luasMax">Menghitung...</span>
      </div>
      <div class="stat-item">
        <span>Luasan Terendah:</span>
        <span class="stat-value" id="luasMin">Menghitung...</span>
      </div>

      <!-- Chart Section -->
      <div class="chart-container">
        <canvas id="densityChart"></canvas>
      </div>

      <button class="download-btn" id="downloadData">
        üì• Download Data GeoJSON
      </button>
    </div>

    <!-- Toolbar -->
    <div class="vtoolbar">
      <div class="vt-btn" id="zoomIn" title="Zoom In">+</div>
      <div class="vt-btn" id="zoomOut" title="Zoom Out">‚àí</div>
      <div class="vt-btn" id="measureBtn" title="Ukur Jarak">üìè</div>
    </div>

    <!-- Scale -->
    <div class="scale-box" id="scaleBox">Skala: 1:100,000</div>
  </div>

  <script>
    // ==================== DATA SAVI DESA TANARA 24 ====================
    const desatanara24 = {
      "type": "FeatureCollection",
      "features": [
        // Data yang Anda berikan dimasukkan di sini
        {"type":"Feature","id":1,"geometry":{"type":"Polygon","coordinates":[[[106.39859628766892,-6.0070804372278017],[106.39859559526178,-6.0068091290474523],[106.3983245956137,-6.0068098221598998],[106.39832528788679,-6.0070811303717742],[106.39859628766892,-6.0070804372278017]]]},"properties":{"OBJECTID":1,"Id":1,"gridcode":2,"Shape_Length":120,"Shape_Area":900}},
        {"type":"Feature","id":2,"geometry":{"type":"Polygon","coordinates":[[[106.39940859401496,-6.0068070489048599],[106.3991375944624,-6.006807742419932],[106.39913828713767,-6.0070790505372065],[106.39940928682428,-6.0070783569905899],[106.39940859401496,-6.0068070489048599]]]},"properties":{"OBJECTID":2,"Id":2,"gridcode":1,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},
        {"type":"Feature","id":3,"geometry":{"type":"Polygon","coordinates":[[[106.39995405873033,-6.0081622015575391],[106.39995336552541,-6.00789089354598],[106.39968236550035,-6.0078915874557],[106.39967959353562,-6.0068063552555788],[106.39940859401496,-6.0068070489048599],[106.39940928682428,-6.0070783569905899],[106.39913828713767,-6.0070790505372065],[106.3991375944624,-6.006807742419932],[106.39940859401496,-6.0068070489048599],[106.3994079012375,-6.0065357408163491],[106.39913690181901,-6.0065364342998757],[106.39913482407994,-6.0057225099231522],[106.39886382503171,-6.0057232031778591],[106.39886244029965,-6.0051805868498542],[106.39859144148764,-6.005181279907311],[106.39859213370373,-6.0054525881042302],[106.39832113472583,-6.0054532810590411],[106.39832182683973,-6.0057245892847213],[106.39805082769597,-6.0057252821368765],[106.39805151970768,-6.0059965903913648],[106.39832251898547,-6.0059958975076881],[106.3983245956137,-6.0068098221598998],[106.39859559526178,-6.0068091290474523],[106.39859628766892,-6.0070804372278017],[106.39886728741922,-6.0070797439496113],[106.39887005790253,-6.0081649765172154],[106.39914105815728,-6.0081642829786546],[106.39968305857118,-6.008162895498816],[106.39995405873033,-6.0081622015575391]]]},"properties":{"OBJECTID":3,"Id":3,"gridcode":3,"Shape_Length":1200.0000000018626,"Shape_Area":29700.000000167638}},
        {"type":"Feature","id":4,"geometry":{"type":"Polygon","coordinates":[[[106.39887005790253,-6.0081649765172154],[106.39887075060298,-6.0084362846522037],[106.39914175099182,-6.0084355910821037],[106.39914105815728,-6.0081642829786546],[106.39887005790253,-6.0081649765172154]]]},"properties":{"OBJECTID":4,"Id":4,"gridcode":1,"Shape_Length":120,"Shape_Area":900}},
        {"type":"Feature","id":5,"geometry":{"type":"Polygon","coordinates":[[[106.39995475196714,-6.0084335095663324],[106.39995405873033,-6.0081622015575391],[106.39968305857118,-6.008162895498816],[106.3996837516739,-6.008434203539168],[106.39995475196714,-6.0084335095663324]]]},"properties":{"OBJECTID":5,"Id":5,"gridcode":1,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},
        {"type":"Feature","id":6,"geometry":{"type":"Polygon","coordinates":[[[106.40049883316428,-6.0092460450383109],[106.40049813956364,-6.0089747371009494],[106.40022713906595,-6.008975431405414],[106.40022575222852,-6.0084328154592521],[106.39995475196714,-6.0084335095663324],[106.39995683186882,-6.0092474335761175],[106.40049883316428,-6.0092460450383109]]]},"properties":{"OBJECTID":6,"Id":6,"gridcode":1,"Shape_Length":300.00000000186265,"Shape_Area":3600.0000000279397}},
        {"type":"Feature","id":7,"geometry":{"type":"Polygon","coordinates":[[[106.40131530536172,-6.0106005003961904],[106.40131461119923,-6.0103291925674256],[106.40104361012664,-6.0103298874326025],[106.40104430415499,-6.0106011952929563],[106.40131530536172,-6.0106005003961904]]]},"properties":{"OBJECTID":7,"Id":7,"gridcode":1,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},
        {"type":"Feature","id":8,"geometry":{"type":"Polygon","coordinates":[[[106.39995683186882,-6.0092474335761175],[106.39996029900911,-6.0106039735370835],[106.40023130034341,-6.0106032791774924],[106.40023199400125,-6.0108745871298419],[106.40050299543782,-6.0108738926043861],[106.40050230164584,-6.0106025846836069],[106.40077330291636,-6.0106018900554288],[106.40077260902214,-6.0103305821634923],[106.40104361012664,-6.0103298874326025],[106.40104291613017,-6.0100585795694652],[106.40077191515982,-6.0100592742687722],[106.40077052753084,-6.009516658471016],[106.40049952679682,-6.0095173529728907],[106.40049883316428,-6.0092460450383109],[106.39995683186882,-6.0092474335761175]]]},"properties":{"OBJECTID":8,"Id":8,"gridcode":3,"Shape_Length":600,"Shape_Area":14400.000000167638}},
        {"type":"Feature","id":9,"geometry":{"type":"Polygon","coordinates":[[[106.40077399684249,-6.0108731979446324],[106.40104499821526,-6.0108725031505772],[106.40104430415499,-6.0106011952929563],[106.40077330291636,-6.0106018900554288],[106.40077399684249,-6.0108731979446324]]]},"properties":{"OBJECTID":9,"Id":9,"gridcode":1,"Shape_Length":120,"Shape_Area":900}},
        {"type":"Feature","id":10,"geometry":{"type":"Polygon","coordinates":[[[106.40131738804067,-6.0114144238659533],[106.40131669378245,-6.0111431160454725],[106.40158769522556,-6.0111424209512236],[106.40158700086511,-6.0108711131595696],[106.40131599955615,-6.0108718082222232],[106.40131530536172,-6.0106005003961904],[106.40104430415499,-6.0106011952929563],[106.40104499821526,-6.0108725031505772],[106.40077399684249,-6.0108731979446324],[106.4007746908005,-6.0111445058310506],[106.40104569230741,-6.0111438110054145],[106.40104638643147,-6.0114151188574843],[106.40131738804067,-6.0114144238659533]]]},"properties":{"OBJECTID":10,"Id":10,"gridcode":3,"Shape_Length":360.00000000186265,"Shape_Area":4500.000000083819}},
        {"type":"Feature","id":11,"geometry":{"type":"Polygon","coordinates":[[[106.40104638643147,-6.0114151188574843],[106.40104708058745,-6.0116864267067527],[106.4013180823308,-6.0116857316836336],[106.40131738804067,-6.0114144238659533],[106.40104638643147,-6.0114151188574843]]]},"properties":{"OBJECTID":11,"Id":11,"gridcode":1,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},
        {"type":"Feature","id":12,"geometry":{"type":"Polygon","coordinates":[[[106.40213178209389,-6.011954953528547],[106.40213039267675,-6.0114123380854911],[106.40185939116328,-6.0114130334799567],[106.40185869663675,-6.0111417257226707],[106.40158769522556,-6.0111424209512236],[106.40131669378245,-6.0111431160454725],[106.40131738804067,-6.0114144238659533],[106.40158838961794,-6.0114137287401102],[106.40158908404223,-6.0116850365261962],[106.40186008572174,-6.0116843412344405],[106.40186078031211,-6.011955648986226],[106.40213178209389,-6.011954953528547]]]},"properties":{"OBJECTID":12,"Id":12,"gridcode":1,"Shape_Length":359.99999999813735,"Shape_Area":4499.9999998882413}},
        {"type":"Feature","id":13,"geometry":{"type":"Polygon","coordinates":[[[106.40240347873439,-6.0122255656223071],[106.40240278384374,-6.0119542579365435],[106.40213178209389,-6.011954953528547],[106.40213247685035,-6.0122262612459227],[106.40240347873439,-6.0122255656223071]]]},"properties":{"OBJECTID":13,"Id":13,"gridcode":1,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},
        {"type":"Feature","id":14,"geometry":{"type":"Polygon","coordinates":[[[106.4021345613113,-6.0130401843814454],[106.40213386645905,-6.0127688766723386],[106.40186286427473,-6.0127695722248387],[106.40186355899277,-6.0130408799655521],[106.4021345613113,-6.0130401843814454]]]},"properties":{"OBJECTID":14,"Id":14,"gridcode":2,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},
        {"type":"Feature","id":15,"geometry":{"type":"Polygon","coordinates":[[[106.40403505608404,-6.0143918489276897],[106.40403366421315,-6.013849233977302],[106.40376266171566,-6.0138499305967921],[106.40376405331811,-6.0143925456104803],[106.40403505608404,-6.0143918489276897]]]},"properties":{"OBJECTID":15,"Id":15,"gridcode":2,"Shape_Length":179.99999999627471,"Shape_Area":1799.9999998882413}},
        {"type":"Feature","id":16,"geometry":{"type":"Polygon","coordinates":[[[106.40295174027496,-6.0146659424501721],[106.40295104482848,-6.0143946348525841],[106.40268004193473,-6.0143953309978642],[106.40268073724698,-6.0146666386270757],[106.40295174027496,-6.0146659424501721]]]},"properties":{"OBJECTID":16,"Id":16,"gridcode":2,"Shape_Length":119.99999999441206,"Shape_Area":899.99999991618097}},
        {"type":"Feature","id":17,"geometry":{"type":"Polygon","coordinates":[[[106.40322274327103,-6.0146652461388825],[106.40322204769031,-6.014393938572927],[106.40376405331811,-6.0143925456104803],[106.40376266171566,-6.0138499305967921],[106.40376196596237,-6.0135786230857793],[106.40349096356709,-6.0135793195392608],[106.40349026797998,-6.0133080119938676],[106.40321926568696,-6.0133087082813512],[106.40321787487699,-6.0127660931189197],[106.40294687282041,-6.0127667892087864],[106.40294617759754,-6.0124954815918201],[106.40267517564322,-6.0124961775157209],[106.40267448058648,-6.0122248698643608],[106.40240347873439,-6.0122255656223071],[106.40213247685035,-6.0122262612459227],[106.40213386645905,-6.0127688766723386],[106.4021345613113,-6.0130401843814454],[106.40213525619546,-6.0133114920877491],[106.40240625861625,-6.0133107963376808],[106.40240834386293,-6.0141247193451459],[106.40267934665441,-6.0141240233658637],[106.40268004193473,-6.0143953309978642],[106.40295104482848,-6.0143946348525841],[106.40295174027496,-6.0146659424501721],[106.40322274327103,-6.0146652461388825]]]},"properties":{"OBJECTID":17,"Id":17,"gridcode":3,"Shape_Length":900,"Shape_Area":28800.000000223517}},
        {"type":"Feature","id":18,"geometry":{"type":"Polygon","coordinates":[[[106.40268143259117,-6.0149379462535544],[106.40268073724698,-6.0146666386270757],[106.40268004193473,-6.0143953309978642],[106.40267934665441,-6.0141240233658637],[106.40240834386293,-6.0141247193451459],[106.40240625861625,-6.0133107963376808],[106.40213525619546,-6.0133114920877491],[106.4021345613113,-6.0130401843814454],[106.40186355899277,-6.0130408799655521],[106.40186564333843,-6.0138548031709833],[106.40213664605956,-6.0138541074920537],[106.40213803605137,-6.0143967228852855],[106.40240903900903,-6.0143960270087637],[106.40241042939701,-6.0149386423276932],[106.40268143259117,-6.0149379462535544]]]},"properties":{"OBJECTID":18,"Id":18,"gridcode":1,"Shape_Length":600.00000000372529,"Shape_Area":9000.0000001955777}},
        {"type":"Feature","id":19,"geometry":{"type":"Polygon","coordinates":[[[106.40295243575339,-6.0149372500450236],[106.40295174027496,-6.0146659424501721],[106.40268073724698,-6.0146666386270757],[106.40268143259117,-6.0149379462535544],[106.40295243575339,-6.0149372500450236]]]},"properties":{"OBJECTID":19,"Id":19,"gridcode":3,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},
        {"type":"Feature","id":20,"geometry":{"type":"Polygon","coordinates":[[[106.40295243575339,-6.0149372500450236],[106.40295313126377,-6.0152085576370906],[106.40268212796731,-6.0152092538772459],[106.40268282337537,-6.0154805614981681],[106.40241181991271,-6.0154812576355461],[106.40241321055616,-6.0160238729323225],[106.40295521798656,-6.0160224803966722],[106.40295452238036,-6.0157511728128803],[106.40349652941447,-6.0157497798028405],[106.4034958335717,-6.0154784722796171],[106.40376683690657,-6.0154777756046283],[106.40376753288359,-6.0157490830962077],[106.40403853632074,-6.0157483862551659],[106.40403784020947,-6.0154770787952367],[106.40430884348039,-6.0154763818514434],[106.40430814726683,-6.0152050744203667],[106.40457915037156,-6.0152043773738333],[106.40457845405574,-6.0149330699716499],[106.40457775777189,-6.0146617625666794],[106.40430675493566,-6.0146624595498883],[106.40430605881802,-6.0143911521105204],[106.40403505608404,-6.0143918489276897],[106.40376405331811,-6.0143925456104803],[106.40376474916728,-6.014663853113154],[106.40322274327103,-6.0146652461388825],[106.40322343888369,-6.0149365537021033],[106.40295243575339,-6.0149372500450236]]]},"properties":{"OBJECTID":20,"Id":20,"gridcode":3,"Shape_Length":899.99999999627471,"Shape_Area":23399.999999888241}},
        {"type":"Feature","id":21,"geometry":{"type":"Polygon","coordinates":[[[106.40403923246399,-6.0160196937123942],[106.40431023600343,-6.0160189967052888],[106.40430953972593,-6.015747689279717],[106.4048515464404,-6.0157462949255924],[106.40485084992635,-6.0154749875606504],[106.40512185310132,-6.0154742902136515],[106.40512115648502,-6.0152029828775797],[106.4048501534443,-6.0152036801929052],[106.40484945699423,-6.0149323728223889],[106.40457845405574,-6.0149330699716499],[106.40457915037156,-6.0152043773738333],[106.40430814726683,-6.0152050744203667],[106.40430884348039,-6.0154763818514434],[106.40403784020947,-6.0154770787952367],[106.40403853632074,-6.0157483862551659],[106.40403923246399,-6.0160196937123942]]]},"properties":{"OBJECTID":21,"Id":21,"gridcode":1,"Shape_Length":480,"Shape_Area":7199.9999999720603}},
        {"type":"Feature","id":22,"geometry":{"type":"Polygon","coordinates":[[[106.40376892493354,-6.0162916980711607],[106.40376822889259,-6.0160203905850862],[106.40349722528919,-6.016021087323363],[106.40349792119588,-6.0162923948410807],[106.40376892493354,-6.0162916980711607]]]},"properties":{"OBJECTID":22,"Id":22,"gridcode":1,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},
        {"type":"Feature","id":23,"geometry":{"type":"Polygon","coordinates":[[[106.40376892493354,-6.0162916980711607],[106.40403992863921,-6.0162910011668194],[106.40403923246399,-6.0160196937123942],[106.40403853632074,-6.0157483862551659],[106.40376753288359,-6.0157490830962077],[106.40349652941447,-6.0157497798028405],[106.40349722528919,-6.016021087323363],[106.40376822889259,-6.0160203905850862],[106.40376892493354,-6.0162916980711607]]]},"properties":{"OBJECTID":23,"Id":23,"gridcode":2,"Shape_Length":240.00000000186265,"Shape_Area":2700.0000000279397}},
        {"type":"Feature","id":24,"geometry":{"type":"Polygon","coordinates":[[[106.40539634047707,-6.0168301292126261],[106.40539564356651,-6.0165588219221],[106.40512463988647,-6.0165595195302242],[106.40512533666272,-6.0168308268524298],[106.40539634047707,-6.0168301292126261]]]},"properties":{"OBJECTID":24,"Id":24,"gridcode":2,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},
        {"type":"Feature","id":25,"geometry":{"type":"Polygon","coordinates":[[[106.40485502949042,-6.0171028317089643],[106.40512603347099,-6.0171021341719158],[106.40512533666272,-6.0168308268524298],[106.40485433281643,-6.0168315243578023],[106.40485502949042,-6.0171028317089643]]]},"properties":{"OBJECTID":25,"Id":25,"gridcode":2,"Shape_Length":120,"Shape_Area":900}},
        {"type":"Feature","id":26,"geometry":{"type":"Polygon","coordinates":[[[106.40703003968365,-6.019810318471464],[106.40702934161502,-6.0195390114016485],[106.40648733165231,-6.0195404087943043],[106.40648802945226,-6.0198117159275482],[106.40703003968365,-6.019810318471464]]]},"properties":{"OBJECTID":26,"Id":26,"gridcode":2,"Shape_Length":179.99999999441206,"Shape_Area":1799.9999998603016}},
        {"type":"Feature","id":27,"geometry":{"type":"Polygon","coordinates":[[[106.40757414499119,-6.0206228414799519],[106.40784515039783,-6.020622142185954],[106.40784445182999,-6.0203508352196282],[106.40730244125339,-6.02035223360964],[106.40730313955251,-6.0206235406394315],[106.40757414499119,-6.0206228414799519]]]},"properties":{"OBJECTID":27,"Id":27,"gridcode":2,"Shape_Length":180,"Shape_Area":1799.9999999441206}},
        {"type":"Feature","id":28,"geometry":{"type":"Polygon","coordinates":[[[106.40757693904563,-6.0217080694445446],[106.40757414499119,-6.0206228414799519],[106.40730313955251,-6.0206235406394315],[106.40730244125339,-6.02035223360964],[106.40730104475129,-6.0198096195416726],[106.40703003968365,-6.019810318471464],[106.40648802945226,-6.0198117159275482],[106.40621702428849,-6.0198124144538427],[106.40621772198611,-6.0200837216160883],[106.405946716656,-6.0200844200395807],[106.4059488095379,-6.0208983416046502],[106.4062198152711,-6.0208976430860588],[106.40622121095453,-6.0214402573855672],[106.40676322286241,-6.0214388598179758],[106.40676392102093,-6.0217101669001218],[106.40757693904563,-6.0217080694445446]]]},"properties":{"OBJECTID":28,"Id":28,"gridcode":1,"Shape_Length":780.00000000186265,"Shape_Area":29700.000000139698}},
        {"type":"Feature","id":29,"geometry":{"type":"Polygon","coordinates":[[[106.40811964976437,-6.0219779773888726],[106.40811895090185,-6.0217066704681175],[106.40757693904563,-6.0217080694445446],[106.40757763763936,-6.0219793764287779],[106.40811964976437,-6.0219779773888726]]]},"properties":{"OBJECTID":29,"Id":29,"gridcode":1,"Shape_Length":180.00000000186265,"Shape_Area":1800.000000083819}},
        {"type":"Feature","id":30,"geometry":{"type":"Polygon","coordinates":[[[106.40866236092454,-6.0222478846652399],[106.40866166176113,-6.0219765778107766],[106.40811964976437,-6.0219779773888726],[106.40812034865895,-6.0222492843068389],[106.40866236092454,-6.0222478846652399]]]},"properties":{"OBJECTID":30,"Id":30,"gridcode":1,"Shape_Length":180.00000000186265,"Shape_Area":1800.0000000279397}},
        {"type":"Feature","id":31,"geometry":{"type":"Polygon","coordinates":[[[106.4089333670092,-6.0222471846426098],[106.40893266771141,-6.0219758778199077],[106.40866166176113,-6.0219765778107766],[106.40866236092454,-6.0222478846652399],[106.4089333670092,-6.0222471846426098]]]},"properties":{"OBJECTID":31,"Id":31,"gridcode":2,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},
        {"type":"Feature","id":32,"geometry":{"type":"Polygon","coordinates":[[[106.40920507252605,-6.0225177912735885],[106.40920437306178,-6.0222464844854251],[106.4089333670092,-6.0222471846426098],[106.40866236092454,-6.0222478846652399],[106.40866306012001,-6.0225191915169294],[106.40920507252605,-6.0225177912735885]]]},"properties":{"OBJECTID":32,"Id":32,"gridcode":1,"Shape_Length":179.99999999813735,"Shape_Area":1799.9999999720603}},
        {"type":"Feature","id":33,"geometry":{"type":"Polygon","coordinates":[[[106.41001879079407,-6.0227869965893985],[106.41001809089447,-6.0225156898993806],[106.40974708480378,-6.0225163904920089],[106.40974778456898,-6.0227876972138112],[106.41001879079407,-6.0227869965893985]]]},"properties":{"OBJECTID":33,"Id":33,"gridcode":2,"Shape_Length":119.99999999441206,"Shape_Area":899.99999991618097}},
        {"type":"Feature","id":34,"geometry":{"type":"Polygon","coordinates":[[[106.41029049705323,-6.0230576024859381],[106.41028979698709,-6.0227862958304179],[106.41001879079407,-6.0227869965893985],[106.41001949072579,-6.0230583032767084],[106.41029049705323,-6.0230576024859381]]]},"properties":{"OBJECTID":34,"Id":34,"gridcode":1,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},
        {"type":"Feature","id":35,"geometry":{"type":"Polygon","coordinates":[[[106.41056150334855,-6.0230569015605964],[106.410560803148,-6.0227855949368729],[106.41028979698709,-6.0227862958304179],[106.41029049705323,-6.0230576024859381],[106.41056150334855,-6.0230569015605964]]]},"properties":{"OBJECTID":35,"Id":35,"gridcode":2,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},
        {"type":"Feature","id":36,"geometry":{"type":"Polygon","coordinates":[[[106.41218824148491,-6.0233239996125505],[106.4124592476897,-6.0233232977133708],[106.41245854651606,-6.0230519913152092],[106.41272955255425,-6.0230512893132975],[106.41272885127836,-6.0227799829441757],[106.41245784537458,-6.02278068491424],[106.41245574214312,-6.0219667656948248],[106.4121847366104,-6.0219674674348038],[106.41218403573197,-6.0216961609909179],[106.41191303030151,-6.0216968625645162],[106.41191232958963,-6.0214255560860561],[106.41164132426137,-6.0214262574932871],[106.41164062371601,-6.0211549509802103],[106.41136961849,-6.0211556522210845],[106.41136821776446,-6.0206130391229493],[106.41109721277506,-6.0206137401656656],[106.41109651259485,-6.020342433580649],[106.4108255077077,-6.0203431344570379],[106.41082480769398,-6.0200718278374232],[106.41028279809198,-6.0200732291230707],[106.4102820983791,-6.0198019224370505],[106.41001109366428,-6.0198026228463268],[106.41001039411786,-6.0195313161258097],[106.40973938950529,-6.0195320163688022],[106.40973869012529,-6.019260709613695],[106.40892567649801,-6.0192628094404039],[106.40892637547499,-6.0195341162908278],[106.40919738018383,-6.0195334164513117],[106.40919807932723,-6.019804723267165],[106.40946908413835,-6.0198040232613836],[106.40946978344819,-6.0200753300427596],[106.40974078836156,-6.0200746298707006],[106.40974148783785,-6.0203459366174918],[106.41001249285347,-6.0203452362791445],[106.41001319249622,-6.0206165429913607],[106.4102841976141,-6.0206158424867118],[106.41028489742334,-6.0208871491643654],[106.41055590264348,-6.0208864484934024],[106.4105566026192,-6.0211577551365352],[106.4108276079416,-6.0211570542992465],[106.41082830808381,-6.0214283609077714],[106.41109931350846,-6.0214276599041447],[106.41110001381719,-6.0216989664780689],[106.41137101934409,-6.0216982653080926],[106.41137171981936,-6.0219695718474622],[106.41164272544852,-6.021968870511123],[106.41164342609031,-6.0222401770158811],[106.41191443182174,-6.0222394755131665],[106.41191583347057,-6.0227820884506738],[106.41218683943865,-6.0227813867497391],[106.41218824148491,-6.0233239996125505]]]},"properties":{"OBJECTID":36,"Id":36,"gridcode":1,"Shape_Length":1739.9999999981374,"Shape_Area":38699.999999916181}},
        {"type":"Feature","id":37,"geometry":{"type":"Polygon","coordinates":[[[106.41110491687799,-6.0235981124180116],[106.41110351584281,-6.0230554993061975],[106.41056150334855,-6.0230569015605964],[106.41056220358121,-6.0233282081815114],[106.41083320997883,-6.0233275070897951],[106.41083391037806,-6.0235988136761156],[106.41110491687799,-6.0235981124180116]]]},"properties":{"OBJECTID":37,"Id":37,"gridcode":1,"Shape_Length":239.99999999441206,"Shape_Area":2699.9999998882413}},
        {"type":"Feature","id":38,"geometry":{"type":"Polygon","coordinates":[[[106.41110491687799,-6.0235981124180116],[106.41110561744377,-6.023869418969749],[106.41137662404599,-6.0238687175452457],[106.41137592334577,-6.0235974110253245],[106.4121889425563,-6.0235953060397627],[106.41218824148491,-6.0233239996125505],[106.41218683943865,-6.0227813867497391],[106.41191583347057,-6.0227820884506738],[106.41191443182174,-6.0222394755131665],[106.41164342609031,-6.0222401770158811],[106.41164272544852,-6.021968870511123],[106.41137171981936,-6.0219695718474622],[106.41137101934409,-6.0216982653080926],[106.41110001381719,-6.0216989664780689],[106.41109931350846,-6.0214276599041447],[106.41082830808381,-6.0214283609077714],[106.4108276079416,-6.0211570542992465],[106.4105566026192,-6.0211577551365352],[106.41055590264348,-6.0208864484934024],[106.41028489742334,-6.0208871491643654],[106.4102841976141,-6.0206158424867118],[106.41001319249622,-6.0206165429913607],[106.41001249285347,-6.0203452362791445],[106.40974148783785,-6.0203459366174918],[106.40974078836156,-6.0200746298707006],[106.40946978344819,-6.0200753300427596],[106.40946908413835,-6.0198040232613836],[106.40919807932723,-6.019804723267165],[106.40919738018383,-6.0195334164513117],[106.40892637547499,-6.0195341162908278],[106.40892567649801,-6.0192628094404039],[106.40838366725272,-6.0192642086524435],[106.40838296857649,-6.0189929017357322],[106.40784095947163,-6.0189943003463355],[106.40784026109611,-6.0187229933633288],[106.4075692566299,-6.0187236924351746],[106.40756855842078,-6.018452385417727],[106.40729755405683,-6.0184530843233688],[106.40729685601407,-6.018181777271387],[106.40702585175241,-6.0181824760108364],[106.40702515387599,-6.0179111689243596],[106.4067541497166,-6.0179118674976273],[106.40675345200654,-6.0176405603766474],[106.40648244794941,-6.0176412587837467],[106.40648175040567,-6.0173699516283188],[106.40621074645081,-6.017370649869263],[106.40621004907339,-6.0170993426793409],[106.4059390452208,-6.0171000407541424],[106.4059383480097,-6.0168287335297164],[106.40566734425938,-6.0168294314383877],[106.40566595020174,-6.0162868169179404],[106.40539494668796,-6.0162875146288046],[106.40539355302687,-6.0157449000338366],[106.40512254974961,-6.0157455975469194],[106.40512185310132,-6.0154742902136515],[106.40485084992635,-6.0154749875606504],[106.4048515464404,-6.0157462949255924],[106.40430953972593,-6.015747689279717],[106.40431023600343,-6.0160189967052888],[106.40403923246399,-6.0160196937123942],[106.40403992863921,-6.0162910011668194],[106.40376892493354,-6.0162916980711607],[106.40349792119588,-6.0162923948410807],[106.40349861713452,-6.0165637023560139],[106.40404062484639,-6.0165623086184565],[106.40404132108556,-6.0168336160673253],[106.40377031711134,-6.0168343130349671],[106.40377170941699,-6.0173769279877609],[106.40404271365978,-6.0173762309568177],[106.40404340999486,-6.0176475383973758],[106.40431441433998,-6.0176468412003317],[106.40431371787062,-6.0173755337914301],[106.40458472204949,-6.0173748364915971],[106.40458402547782,-6.017103529111572],[106.40485502949042,-6.0171028317089643],[106.40485433281643,-6.0168315243578023],[106.40512533666272,-6.0168308268524298],[106.40512463988647,-6.0165595195302242],[106.40539564356651,-6.0165588219221],[106.40539634047707,-6.0168301292126261],[106.4053970374196,-6.0171014365004298],[106.40566804133623,-6.0171007386945048],[106.40566943558591,-6.0176433531983466],[106.40594043973908,-6.0176426551945976],[106.40594113704624,-6.0179139624106943],[106.40621214130172,-6.0179132642407955],[106.40621423381822,-6.0187271857772799],[106.40648523844462,-6.0187264873778092],[106.40648593614848,-6.018997794519434],[106.4067569408772,-6.018997095953778],[106.40675763874742,-6.0192684030608845],[106.40702864357841,-6.0192677043290281],[106.40702934161502,-6.0195390114016485],[106.40703003968365,-6.019810318471464],[106.40730104475129,-6.0198096195416726],[106.40730244125339,-6.02035223360964],[106.40784445182999,-6.0203508352196282],[106.40784515039783,-6.020622142185954],[106.40757414499119,-6.0206228414799519],[106.40757693904563,-6.0217080694445446],[106.40811895090185,-6.0217066704681175],[106.40811964976437,-6.0219779773888726],[106.40866166176113,-6.0219765778107766],[106.40893266771141,-6.0219758778199077],[106.4089333670092,-6.0222471846426098],[106.40920437306178,-6.0222464844854251],[106.40920507252605,-6.0225177912735885],[106.40974708480378,-6.0225163904920089],[106.41001809089447,-6.0225156898993806],[106.41001879079407,-6.0227869965893985],[106.41028979698709,-6.0227862958304179],[106.410560803148,-6.0227855949368729],[106.41056150334855,-6.0230569015605964],[106.41110351584281,-6.0230554993061975],[106.41110491687799,-6.0235981124180116]]]},"properties":{"OBJECTID":38,"Id":38,"gridcode":3,"Shape_Length":4139.9999999925494,"Shape_Area":183599.9999998603}}
      ]
    };

    // ==================== INISIALISASI PETA ====================
    // Pusat peta di lokasi Desa Tanara
    const map = L.map('map').setView([-6.007, 106.399], 14);

    // Layer Dasar
    const basemaps = {
      'osm': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }),
      'satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '¬© Esri'
      }),
      'terrain': L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg', {
        attribution: '¬© Stamen Design'
      })
    };

    let currentBasemap = 'satellite';
    basemaps[currentBasemap].addTo(map);

    // ==================== TOGGLE CONTROLS ====================
    // Toggle Statistics Panel
    document.getElementById('statsToggle').addEventListener('click', function() {
        const statsPanel = document.getElementById('statsPanel');
        statsPanel.style.display = statsPanel.style.display === 'none' ? 'block' : 'none';
    });

    // Close Statistics Panel
    document.getElementById('statsClose').addEventListener('click', function() {
        document.getElementById('statsPanel').style.display = 'none';
    });

    // Toggle Basemap
    document.getElementById('basemapFlipBtn').addEventListener('click', function() {
        // Rotate through basemaps
        const basemapKeys = Object.keys(basemaps);
        const currentIndex = basemapKeys.indexOf(currentBasemap);
        const nextIndex = (currentIndex + 1) % basemapKeys.length;
        const nextBasemap = basemapKeys[nextIndex];
        
        if (basemaps[currentBasemap]) {
            map.removeLayer(basemaps[currentBasemap]);
        }
        
        basemaps[nextBasemap].addTo(map);
        currentBasemap = nextBasemap;
        
        // Update button text based on basemap
        const basemapIcons = {
            'osm': 'üó∫Ô∏è',
            'satellite': 'üõ∞Ô∏è',
            'terrain': 'üèîÔ∏è'
        };
        this.textContent = basemapIcons[nextBasemap] || 'üó∫Ô∏è';
    });

    // Toolbar Controls
    document.getElementById('zoomIn').addEventListener('click', function() {
        map.zoomIn();
    });

    document.getElementById('zoomOut').addEventListener('click', function() {
        map.zoomOut();
    });

    // Search Functionality
    document.getElementById('doSearch').addEventListener('click', function() {
        performSearch();
    });

    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    function performSearch() {
        const query = document.getElementById('searchInput').value.trim();
        
        if (!query) return;
        
        // Cek jika query adalah koordinat
        const coordMatch = query.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);
        
        if (coordMatch) {
            const lat = parseFloat(coordMatch[1]);
            const lng = parseFloat(coordMatch[2]);
            
            if (!isNaN(lat) && !isNaN(lng)) {
                map.setView([lat, lng], 16);
                L.marker([lat, lng]).addTo(map)
                    .bindPopup(`Lokasi: ${lat}, ${lng}`)
                    .openPopup();
                return;
            }
        }
        
        alert('Silakan gunakan format koordinat: latitude,longitude (contoh: -6.007,106.399)');
    }

    // ==================== SISTEM INTEGRASI GEOJSON ====================
    let geoJSONLayer = null;
    let densityChart = null;

    // Fungsi untuk memuat dan menampilkan data GeoJSON
    function loadGeoJSONData() {
        // Hapus layer sebelumnya jika ada
        if (geoJSONLayer) {
            map.removeLayer(geoJSONLayer);
        }
        
        const data = desatanara24;
        
        // Hitung statistik
        calculateStatistics(data);
        
        // Style berdasarkan gridcode (kerapatan vegetasi)
        function getStyleByGridcode(feature) {
            const gridcode = feature.properties.gridcode;
            let color, opacity, weight;
            
            switch(gridcode) {
                case 1: // Sangat Rendah
                    color = '#ffffcc';
                    opacity = 0.7;
                    weight = 1;
                    break;
                case 2: // Rendah
                    color = '#c2e699';
                    opacity = 0.7;
                    weight = 1;
                    break;
                case 3: // Sedang-Rendah
                    color = '#78c679';
                    opacity = 0.7;
                    weight = 1.5;
                    break;
                case 4: // Sedang
                    color = '#31a354';
                    opacity = 0.8;
                    weight = 2;
                    break;
                case 5: // Tinggi
                    color = '#006837';
                    opacity = 0.9;
                    weight = 2.5;
                    break;
                case 6: // Sangat Tinggi
                    color = '#004529';
                    opacity = 1;
                    weight = 3;
                    break;
                default:
                    color = '#808080';
                    opacity = 0.5;
                    weight = 1;
            }
            
            return {
                fillColor: color,
                color: color,
                weight: weight,
                opacity: 0.8,
                fillOpacity: opacity
            };
        }
        
        // Tambah layer GeoJSON ke peta
        geoJSONLayer = L.geoJSON(data, {
            style: getStyleByGridcode,
            onEachFeature: function(feature, layer) {
                const props = feature.properties;
                
                let popupContent = `
                    <div style="max-width: 280px;">
                        <h4 style="margin:0 0 8px 0; color: #0a5c36; border-bottom: 2px solid #0a5c36; padding-bottom: 4px;">
                            Savi Desa Tanara 24 - Poligon ${props.Id}
                        </h4>
                        <div style="font-size: 12px; color: #333; line-height: 1.4;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Kerapatan:</strong> 
                                <span style="color: ${getColorByGridcode(props.gridcode)}; font-weight: bold;">
                                    ${getKerapatanLabel(props.gridcode)}
                                </span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Gridcode:</strong> <span>${props.gridcode || 'N/A'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Luasan:</strong> <span>${props.Shape_Area ? (props.Shape_Area / 10000).toFixed(4) + ' ha' : 'N/A'}</span>
                            </div>
                        </div>
                `;
                
                popupContent += `</div>`;
                layer.bindPopup(popupContent);
                
                // Tooltip
                layer.bindTooltip(`Savi Desa Tanara 24 - ${getKerapatanLabel(props.gridcode)} (${(props.Shape_Area / 10000).toFixed(4)} ha)`, {
                    permanent: false,
                    direction: 'auto',
                    className: 'custom-tooltip'
                });
            }
        }).addTo(map);
        
        // Fit bounds ke data
        map.fitBounds(geoJSONLayer.getBounds());
        
        console.log(`Data Savi Desa Tanara 24 berhasil dimuat - ${data.features.length} fitur`);
    }

    // Fungsi untuk mendapatkan label kerapatan
    function getKerapatanLabel(gridcode) {
        switch(gridcode) {
            case 1: return "Sangat Rendah";
            case 2: return "Rendah";
            case 3: return "Sedang-Rendah";
            case 4: return "Sedang";
            case 5: return "Tinggi";
            case 6: return "Sangat Tinggi";
            default: return "Tidak Diketahui";
        }
    }

    // Fungsi untuk menghitung statistik
    function calculateStatistics(data) {
        let totalLuasan = 0;
        let jumlahPoligon = data.features.length;
        let luasanMax = 0;
        let luasanMin = Infinity;
        let kerapatanRata = 0;
        
        const densityCount = {
            1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0
        };
        
        data.features.forEach(feature => {
            const luasan = feature.properties.Shape_Area / 10000; // Convert dari m¬≤ ke hektar
            const gridcode = feature.properties.gridcode || 1;
            
            totalLuasan += luasan;
            densityCount[gridcode]++;
            
            if (luasan > luasanMax) luasanMax = luasan;
            if (luasan < luasanMin) luasanMin = luasan;
            kerapatanRata += gridcode;
        });
        
        kerapatanRata = (kerapatanRata / jumlahPoligon).toFixed(1);
        
        // Update statistik panel
        document.getElementById('totalLuas').textContent = totalLuasan.toFixed(4) + ' ha';
        document.getElementById('jumlahPoligon').textContent = jumlahPoligon;
        document.getElementById('kerapatanRata').textContent = kerapatanRata;
        document.getElementById('luasMax').textContent = luasanMax.toFixed(4) + ' ha';
        document.getElementById('luasMin').textContent = luasanMin.toFixed(4) + ' ha';
        
        // Update chart
        updateDensityChart(densityCount);
    }

    // Fungsi untuk update chart kerapatan
    function updateDensityChart(densityCount) {
        const ctx = document.getElementById('densityChart').getContext('2d');
        
        if (densityChart) {
            densityChart.destroy();
        }
        
        densityChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Sangat Rendah', 'Rendah', 'Sedang-Rendah', 'Sedang', 'Tinggi', 'Sangat Tinggi'],
                datasets: [{
                    label: 'Distribusi Kerapatan',
                    data: [
                        densityCount[1],
                        densityCount[2],
                        densityCount[3],
                        densityCount[4],
                        densityCount[5],
                        densityCount[6]
                    ],
                    backgroundColor: [
                        '#ffffcc',
                        '#c2e699',
                        '#78c679',
                        '#31a354',
                        '#006837',
                        '#004529'
                    ],
                    borderColor: [
                        '#d9d9a3',
                        '#a8c97f',
                        '#5fa85a',
                        '#298845',
                        '#005426',
                        '#003318'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 10
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'Distribusi Kerapatan Savi',
                        font: {
                            size: 12
                        }
                    }
                }
            }
        });
    }

    // Fungsi untuk mendapatkan warna berdasarkan gridcode
    function getColorByGridcode(gridcode) {
        switch(gridcode) {
            case 1: return '#ffffcc';
            case 2: return '#c2e699';
            case 3: return '#78c679';
            case 4: return '#31a354';
            case 5: return '#006837';
            case 6: return '#004529';
            default: return '#808080';
        }
    }

    // Download Data GeoJSON
    document.getElementById('downloadData').addEventListener('click', function() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(desatanara24, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "savi_desa_tanara_24.geojson");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
        
        alert('Data GeoJSON Savi Desa Tanara 24 berhasil diunduh!');
    });

    // ==================== INISIALISASI ====================
    document.addEventListener('DOMContentLoaded', function() {
        // Load data Savi Desa Tanara 24
        setTimeout(() => {
            loadGeoJSONData();
        }, 1000);
        
        // Scale update
        map.on('zoomend', function() {
            const zoom = map.getZoom();
            const scale = Math.round(591657550 / Math.pow(2, zoom - 1));
            document.getElementById('scaleBox').textContent = `Skala: 1:${scale.toLocaleString()}`;
        });
        map.fire('zoomend');
    });

  </script>

</body>
</html>