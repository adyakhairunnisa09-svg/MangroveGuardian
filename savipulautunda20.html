<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mangrove Guardian - Savi Pulau Tunda20</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <!-- Leaflet Draw -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/leaflet.draw/1.0.4/leaflet.draw-src.css" />
  <script src="https://cdnjs.cloudflare.com/leaflet.draw/1.0.4/leaflet.draw-src.js"></script>
  <!-- Chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>

  <style>
    /* VARIABLES */
    :root{
      --mg-green:#0a5c36;
      --mg-green-light:#1a7d4e;
      --mg-green-dark:#064527;
      --panel:rgba(255,255,255,0.95);
      --muted:#51606a;
      --navbar-height: 60px; 
    }
    
    *{box-sizing:border-box; margin:0; padding:0;}
    
    html,body{height:100%; margin:0; font-family:'Segoe UI', system-ui, sans-serif; color:#15302a;}
    body{background:#f8f9fa;}
    #map{flex:1; z-index:1;}

    .topbar{
      height: var(--navbar-height);
      padding:0 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:var(--mg-green);
      color:#fff;
      position:sticky;
      top:0;
      z-index:1500;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-bottom: 1px solid var(--mg-green-dark);
    }
    
    .brand{
      font-weight:600;
      font-size:20px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    
    .nav-right-container{display:flex; align-items:center; gap:25px;}
    .nav-menu{display:flex; gap:25px}
    .nav-menu a{
      color:#fff;
      text-decoration:none;
      font-size:14px;
      font-weight:500;
      padding:8px 0;
      transition:opacity 0.2s;
    }
    .nav-menu a:hover{opacity:0.8;}
    .lang-switch{
      font-size:13px;
      cursor:pointer;
      background:rgba(255,255,255,0.15);
      padding:6px 12px;
      border-radius:4px;
      font-weight:500;
    }

    .chat-box-container{
      position:fixed;
      bottom:20px;
      right:20px;
      z-index:1600;
      width:350px;
      background:var(--panel);
      border-radius:8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border:1px solid #e1e5e9;
      display:flex;
      flex-direction:column;
      max-height:500px;
    }
    
    .chat-header{
      background: var(--mg-green);
      color: #fff;
      padding: 12px 16px;
      font-weight: 600;
      cursor:pointer;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-radius:8px 8px 0 0;
    }
    
    .chat-content{
      padding: 16px;
      flex:1;
      overflow-y: auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      max-height:300px;
    }
    
    .chat-input-row{
      display:flex;
      gap:8px;
      padding:12px 16px;
      border-top:1px solid #e1e5e9;
      background:#f8f9fa;
    }
    
    .chat-input-row input{
      flex:1;
      padding:10px 12px;
      border-radius:6px;
      border:1px solid #ddd;
      outline:none;
      font-size:14px;
      background:#fff;
    }
    
    .chat-input-row button{
      background:var(--mg-green);
      border:0;
      color:#fff;
      padding:10px 16px;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
    }

    .chat-message{
      padding:10px 14px;
      border-radius:8px;
      max-width:85%;
      font-size:14px;
      line-height:1.4;
    }
    
    .chat-user{
      background:#e3f2fd;
      align-self:flex-end;
      border-bottom-right-radius:2px;
    }
    
    .chat-bot{
      background:#f5f5f5;
      align-self:flex-start;
      border-bottom-left-radius:2px;
    }

    .app{
      height:calc(100vh - var(--navbar-height));
      position:relative;
      display:flex;
    }

    .search-row-container{
      position:absolute;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      z-index:1300;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      width:90%;
      max-width:700px;
    }
    
    .search-row{
      display:flex;
      align-items:center;
      gap:8px;
      width:100%;
    }
    
    .search-box{
      display:flex;
      align-items:center;
      background:var(--panel);
      padding:8px 16px;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      width:100%;
      border:1px solid #e1e5e9;
      flex:1;
    }
    
    .search-box input{
      border:0;
      outline:none;
      padding:8px;
      font-size:14px;
      background:transparent;
      flex:1;
    }
    
    .search-box button{
      background:var(--mg-green);
      border:0;
      color:#fff;
      padding:8px 16px;
      border-radius:6px;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
    }
    
    .action-btn{
      background:var(--mg-green);
      color:#fff;
      border-radius:8px;
      padding:10px 16px;
      border:none;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
      white-space:nowrap;
    }
    
    .mapFlipBtn{
      background:var(--mg-green);
      border:none;
      padding:10px;
      border-radius:6px;
      color:white;
      cursor:pointer;
      font-size:16px;
    }

    .stats-toggle-btn {
      background:var(--mg-green);
      border:none;
      padding:10px 14px;
      border-radius:6px;
      color:white;
      cursor:pointer;
      font-size:16px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
      transition:all 0.3s ease;
      white-space: nowrap;
    }

    .stats-toggle-btn:hover {
      background:var(--mg-green-light);
      transform: translateY(-1px);
    }

    .vtoolbar{
      position:absolute;
      left:20px;
      top:120px;
      z-index:1300;
      display:flex;
      flex-direction:column;
      gap:8px;
      padding:8px;
      border-radius:8px;
      background:transparent;
    }
    
    .vt-btn{
      width:44px;
      height:44px;
      border-radius:6px;
      background:var(--panel);
      display:flex;
      align-items:center;
      justify-content:center;
      border:1px solid #e1e5e9;
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
      cursor:pointer;
      font-size:16px;
      transition:all 0.2s;
    }
    
    .vt-btn:hover{
      background:#f8f9fa;
    }

    .right-panel{
      position:absolute;
      right:20px;
      top:20px;
      width:320px;
      z-index:1300;
      background:var(--panel);
      border-radius:8px;
      box-shadow:0 4px 20px rgba(0,0,0,0.15);
      border:1px solid #e1e5e9;
      max-height:calc(100vh - 100px);
      overflow-y:auto;
    }
    
    .panel-inner{
      padding:16px;
    }
    
    .panel-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:16px;
      padding-bottom:12px;
      border-bottom:1px solid #e1e5e9;
    }
    
    .panel-header h3{
      margin:0;
      color:var(--mg-green);
      font-size:16px;
      font-weight:600;
    }

    .switch-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 0;
      border-bottom:1px solid #f0f0f0;
    }
    
    .switch-label{
      font-size:14px;
      color:#333;
    }
    
    .switch{
      position:relative;
      width:44px;
      height:24px;
      border-radius:12px;
      background:#ddd;
      cursor:pointer;
    }
    
    .switch .knob{
      position:absolute;
      top:2px;
      left:2px;
      width:20px;
      height:20px;
      border-radius:50%;
      background:white;
      box-shadow:0 1px 3px rgba(0,0,0,0.2);
      transition:left 0.2s;
    }
    
    .switch.on{
      background:var(--mg-green);
    }
    
    .switch.on .knob{
      left:22px;
    }

    .basemap-toggle{
      position:absolute;
      right:20px;
      top:70px;
      z-index:1350;
    }
    
    .basemap-card{
      width:250px;
      background:var(--panel);
      border-radius:8px;
      padding:12px;
      box-shadow:0 4px 20px rgba(0,0,0,0.15);
      border:1px solid #e1e5e9;
    }
    
    .basemap-card.hidden{
      display:none;
    }
    
    .basemap-item{
      padding:10px;
      border-radius:6px;
      margin-bottom:6px;
      cursor:pointer;
      font-size:14px;
      border:1px solid transparent;
    }
    
    .basemap-item:hover{
      background:#f8f9fa;
    }
    
    .basemap-item.active{
      background:#e8f5e8;
      border-color:var(--mg-green);
    }

    .scale-box{
      position:absolute;
      left:20px;
      bottom:20px;
      background:var(--panel);
      padding:8px 12px;
      border-radius:6px;
      font-size:12px;
      border:1px solid #e1e5e9;
      z-index:1300;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }

    .class-item{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 0;
      border-bottom:1px solid #f0f0f0;
    }
    
    .class-color{
      width:16px;
      height:16px;
      border-radius:3px;
    }
    
    .class-label{
      flex:1;
      font-size:13px;
    }

    .file-upload{
      margin-top:16px;
      padding:12px;
      border:2px dashed #ddd;
      border-radius:6px;
      text-align:center;
      cursor:pointer;
      transition:border-color 0.2s;
    }
    
    .file-upload:hover{
      border-color:var(--mg-green);
    }
    
    .file-hint{
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
      text-align:center;
    }

    .vt-btn.active-draw{
      background:var(--mg-green);
      color:#fff;
    }
    
    .vt-btn.delete-active{
      background:#dc3545;
      color:#fff;
    }

    @media (max-width:768px){
      .nav-menu{display:none}
      .search-row{flex-wrap:wrap;}
      .right-panel{width:95%; right:2.5%;}
      .chat-box-container{width:95%; right:2.5%;}
      .stats-panel{width:95%; left:2.5%;}
      .stats-toggle-btn{display:none;}
    }

    .analysis-section {
      margin: 16px 0;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
    }
    
    .pulau-selector {
      margin-bottom: 12px;
    }
    
    .pulau-selector select {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    
    .data-display {
      background: white;
      padding: 12px;
      border-radius: 4px;
      margin-top: 8px;
    }
    
    .data-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: 13px;
    }
    
    .data-value {
      font-weight: 600;
      color: var(--mg-green);
    }

    .custom-tooltip {
      background: rgba(255, 255, 255, 0.95) !important;
      border: 1px solid #0a5c36 !important;
      border-radius: 4px !important;
      padding: 4px 8px !important;
      font-size: 12px !important;
      font-weight: 500 !important;
    }

    .legend {
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    
    .legend h4 {
      margin: 0 0 8px 0;
    }

    .stats-panel {
      position: absolute;
      left: 80px;
      top: 120px;
      z-index: 1300;
      background: var(--panel);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      border: 1px solid #e1e5e9;
      width: 300px;
      max-height: 75vh;
      overflow-y: auto;
      transition: all 0.3s ease;
    }

    .stats-header {
      font-weight: 600;
      color: var(--mg-green);
      margin-bottom: 12px;
      font-size: 16px;
      border-bottom: 2px solid var(--mg-green);
      padding-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stats-close {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: var(--muted);
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stats-close:hover {
      color: var(--mg-green);
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 13px;
      padding: 6px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .stat-item:last-child {
      border-bottom: none;
    }

    .stat-value {
      font-weight: 600;
      color: var(--mg-green);
    }

    .chart-container {
      margin-top: 15px;
      height: 200px;
      position: relative;
    }

    .download-btn {
      background: var(--mg-green);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin-top: 15px;
      width: 100%;
      transition: background 0.3s ease;
    }

    .download-btn:hover {
      background: var(--mg-green-light);
    }

    .collapsible {
      margin-top: 10px;
    }

    .collapsible-header {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 13px;
      color: var(--mg-green);
    }

    .collapsible-content {
      padding: 10px;
      background: white;
      border-radius: 0 0 6px 6px;
      margin-top: 2px;
    }

    .collapsible.hidden .collapsible-content {
      display: none;
    }

    /* Progress Bar untuk Loading */
    .progress-bar {
      width: 100%;
      height: 4px;
      background: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--mg-green);
      transition: width 0.3s ease;
    }

    /* Filter Controls */
    .filter-controls {
      margin: 15px 0;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
    }

    .filter-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--mg-green);
    }

    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .filter-btn {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .filter-btn.active {
      background: var(--mg-green);
      color: white;
      border-color: var(--mg-green);
    }

    .filter-btn:hover {
      background: #e9ecef;
    }

    .filter-btn.active:hover {
      background: var(--mg-green-light);
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="topbar">
    <div class="brand">
      <span>üåø MangroveGuardian - Savi Pulau Tunda20</span>
    </div>
    <div class="nav-right-container">
      <div class="nav-menu" id="navMenu">
        <a href="index.html" data-key="home">HOME</a>
        <a href="evicipasilin20.html" data-key="home">Data Mangrove/tahun</a>
      </div>
      <div class="lang-switch" id="langSwitch">ID / EN</div>
    </div>
  </div>

  <!-- Chat Box -->
  <div class="chat-box-container" id="chatBoxContainer">
    <div class="chat-header" id="chatHeader">
      <span>üí¨ Asisten Mangrove</span>
      <span>‚àí</span>
    </div>
    <div class="chat-content" id="chatContent">
      <div class="chat-message chat-bot">Halo! Saya asisten virtual Mangrove Guardian. Data Savi Pulau Tunda20 memiliki 100 poligon dengan total luasan yang akan ditampilkan.</div>
    </div>
    <div class="chat-input-row">
      <input type="text" id="chatInput" placeholder="Ketik pertanyaan Anda..." />
      <button id="sendChat">Kirim</button>
    </div>
  </div>

  <!-- Main App -->
  <div class="app">
    <div id="map"></div>

    <!-- Search Bar dengan Tombol Statistik di Kiri -->
    <div class="search-row-container">
      <div class="search-row">
        <!-- Tombol Statistik di sebelah kiri search box -->
        <button class="stats-toggle-btn" id="statsToggle" title="Toggle Panel Statistik">
          üìä Statistik
        </button>

        <!-- Search Box di tengah -->
        <div class="search-box">
          <input id="searchInput" placeholder="Cari lokasi atau koordinat (contoh: -5.810,106.259)..." />
          <button id="doSearch">Cari</button>
        </div>

        <!-- Tombol-tombol lainnya di sebelah kanan -->
        <button class="action-btn" id="addPointBtn">+ Titik Baru</button>
        <button id="basemapFlipBtn" class="mapFlipBtn" title="Peta Dasar">üó∫Ô∏è</button>
        <button id="togglePanelBtn" class="mapFlipBtn" title="Panel Layer">‚ò∞</button>
      </div>
    </div>

    <!-- Statistics Panel -->
    <div class="stats-panel" id="statsPanel">
      <div class="stats-header">
        <span>üìä Statistik Savi Pulau Tunda20</span>
        <button class="stats-close" id="statsClose" title="Tutup">‚úï</button>
      </div>
      
      <div class="progress-bar">
        <div class="progress-fill" id="dataProgress" style="width: 100%"></div>
      </div>
      
      <div class="stat-item">
        <span>Total Luasan:</span>
        <span class="stat-value" id="totalLuas">Loading...</span>
      </div>
      <div class="stat-item">
        <span>Jumlah Poligon:</span>
        <span class="stat-value" id="jumlahPoligon">100</span>
      </div>
      <div class="stat-item">
        <span>Kerapatan Rata-rata:</span>
        <span class="stat-value" id="kerapatanRata">Loading...</span>
      </div>
      <div class="stat-item">
        <span>Luasan Tertinggi:</span>
        <span class="stat-value" id="luasMax">Loading...</span>
      </div>
      <div class="stat-item">
        <span>Luasan Terendah:</span>
        <span class="stat-value" id="luasMin">Loading...</span>
      </div>

      <!-- Filter Controls -->
      <div class="filter-controls">
        <div class="filter-title">Filter Kerapatan:</div>
        <div class="filter-buttons">
          <button class="filter-btn active" data-density="all">Semua</button>
          <button class="filter-btn" data-density="1">Sangat Rendah</button>
          <button class="filter-btn" data-density="2">Rendah</button>
          <button class="filter-btn" data-density="3">Sedang-Rendah</button>
          <button class="filter-btn" data-density="4">Sedang</button>
          <button class="filter-btn" data-density="5">Tinggi</button>
          <button class="filter-btn" data-density="6">Sangat Tinggi</button>
        </div>
      </div>

      <!-- Collapsible Chart Section -->
      <div class="collapsible" id="chartCollapsible">
        <div class="collapsible-header" id="chartHeader">
          <span>üìà Grafik Distribusi</span>
          <span>‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div class="chart-container">
            <canvas id="densityChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Collapsible Detail Section -->
      <div class="collapsible" id="detailCollapsible">
        <div class="collapsible-header" id="detailHeader">
          <span>üîç Detail Kerapatan</span>
          <span>‚ñº</span>
        </div>
        <div class="collapsible-content">
          <div class="stat-item">
            <span>Sangat Rendah (1):</span>
            <span class="stat-value" id="detailSangatRendah">Loading...</span>
          </div>
          <div class="stat-item">
            <span>Rendah (2):</span>
            <span class="stat-value" id="detailRendah">Loading...</span>
          </div>
          <div class="stat-item">
            <span>Sedang-Rendah (3):</span>
            <span class="stat-value" id="detailSedangRendah">Loading...</span>
          </div>
          <div class="stat-item">
            <span>Sedang (4):</span>
            <span class="stat-value" id="detailSedang">Loading...</span>
          </div>
          <div class="stat-item">
            <span>Tinggi (5):</span>
            <span class="stat-value" id="detailTinggi">Loading...</span>
          </div>
          <div class="stat-item">
            <span>Sangat Tinggi (6):</span>
            <span class="stat-value" id="detailSangatTinggi">Loading...</span>
          </div>
        </div>
      </div>

      <button class="download-btn" id="downloadData">
        üì• Download Data GeoJSON
      </button>

      <button class="download-btn" id="screenshot" style="background: #6c757d; margin-top: 8px;">
        üì∑ Screenshot Peta
      </button>
    </div>

    <!-- Toolbar -->
    <div class="vtoolbar">
      <div class="vt-btn" id="zoomIn" title="Zoom In">+</div>
      <div class="vt-btn" id="zoomOut" title="Zoom Out">‚àí</div>
      <div class="vt-btn" id="measureBtn" title="Ukur Jarak">üìè</div>
      <div style="border-top:1px solid #eee; margin:6px 0"></div>
      <div class="vt-btn" id="drawPt" title="Titik">‚Ä¢</div>
      <div class="vt-btn" id="drawPoly" title="Poligon">‚ñ≥</div>
      <div class="vt-btn" id="drawRect" title="Persegi">‚ñ°</div>
      <div style="border-top:1px solid #eee; margin:6px 0"></div>
      <div class="vt-btn" id="deleteBtn" title="Hapus">üóëÔ∏è</div>
      <div class="vt-btn" id="printBtn" title="Cetak">üñ®Ô∏è</div>
    </div>

    <!-- Scale -->
    <div class="scale-box" id="scaleBox">Skala: 1:100,000</div>
    <div class="scale-box" id="measureBox" style="left:120px; display:none; background:#fff3cd; color:#856404;"></div>

    <!-- Right Panel -->
    <div class="right-panel" id="rightPanel">
      <div class="panel-inner">
        <div class="panel-header">
          <h3>Layer & Pengaturan</h3>
          <button id="closePanel" class="vt-btn" style="width:auto; padding:6px 10px;">‚úï</button>
        </div>

        <!-- Analisis Vegetasi Section -->
        <div class="analysis-section">
          <div style="font-weight:600; color:var(--mg-green); margin-bottom:12px;">üìä Data Savi Pulau Tunda20</div>
          
          <div class="pulau-selector">
            <label for="pulauSelect">Pilih Lokasi:</label>
            <select id="pulauSelect">
              <option value="savipulautunda20" selected>Savi Pulau Tunda20</option>
            </select>
          </div>

          <div class="pulau-selector">
            <label for="tahunSelect">Pilih Tahun:</label>
            <select id="tahunSelect">
              <option value="2024" selected>2024</option>
            </select>
          </div>

          <div class="data-display">
            <div class="data-item">
              <span>Vegetasi Sangat Rendah:</span>
              <span class="data-value" id="dataSangatRendah">Loading...</span>
            </div>
            <div class="data-item">
              <span>Vegetasi Rendah:</span>
              <span class="data-value" id="dataRendah">Loading...</span>
            </div>
            <div class="data-item">
              <span>Vegetasi Sedang-Rendah:</span>
              <span class="data-value" id="dataSedangRendah">Loading...</span>
            </div>
            <div class="data-item">
              <span>Vegetasi Sedang:</span>
              <span class="data-value" id="dataSedang">Loading...</span>
            </div>
            <div class="data-item">
              <span>Vegetasi Tinggi:</span>
              <span class="data-value" id="dataTinggi">Loading...</span>
            </div>
            <div class="data-item">
              <span>Vegetasi Sangat Tinggi:</span>
              <span class="data-value" id="dataSangatTinggi">Loading...</span>
            </div>
            <div class="data-item">
              <span>EVI Rata-rata:</span>
              <span class="data-value" id="dataEVI">Loading...</span>
            </div>
          </div>
        </div>

        <div class="switch-row">
          <div class="switch-label">Layer EVI</div>
          <div class="switch on" id="rasterSwitch"><div class="knob"></div></div>
        </div>

        <div style="margin:16px 0;">
          <div style="font-weight:600; color:var(--mg-green); margin-bottom:12px;">Kelas Kerapatan EVI</div>
          <div id="classesList"></div>
        </div>

        <hr style="margin:16px 0; border:none; border-top:1px solid #e1e5e9;">

        <div style="font-weight:600; color:var(--mg-green); margin-bottom:12px;">Ekspor Data</div>
        <div class="file-upload" id="fileUploadArea">
          <div>üìÅ Upload File GeoJSON</div>
          <input type="file" id="fileInput" accept=".json,.geojson" style="display:none" />
        </div>
        <div class="file-hint">Format yang didukung: GeoJSON, JSON</div>

        <button class="download-btn" id="exportReport">
          üìÑ Export Laporan PDF
        </button>
      </div>
    </div>

    <!-- Basemap Panel -->
    <div class="basemap-toggle">
      <div class="basemap-card hidden" id="basemapCard">
        <div style="font-weight:600; margin-bottom:12px;">Peta Dasar</div>
        <div class="basemap-item active" data-basemap="osm">OpenStreetMap</div>
        <div class="basemap-item" data-basemap="satellite">Satelit</div>
        <div class="basemap-item" data-basemap="terrain">Topografi</div>
      </div>
    </div>
  </div>

  <script>
    // ==================== DATA GEOJSON SAVI PULAU TUNDA20 ====================
    const savipulautunda20 = {"type":"FeatureCollection","features":[{"type":"Feature","id":1,"geometry":{"type":"Polygon","coordinates":[[[106.25912414768281,-5.8104367775015104],[106.25912354486125,-5.8101654519850774],[106.25831078644364,-5.8101672625333221],[106.25831138887634,-5.8104385881348666],[106.25885322810927,-5.8104373811757828],[106.25912414768281,-5.8104367775015104]]]},"properties":{"OBJECTID":1,"Id":1,"gridcode":5,"Shape_Length":240,"Shape_Area":2700}},{"type":"Feature","id":2,"geometry":{"type":"Polygon","coordinates":[[[106.25912414768281,-5.8104367775015104],[106.25939506722771,-5.8104361736974175],[106.25939446427654,-5.8101648482093653],[106.25912354486125,-5.8101654519850774],[106.25912414768281,-5.8104367775015104]]]},"properties":{"OBJECTID":2,"Id":2,"gridcode":1,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":3,"geometry":{"type":"Polygon","coordinates":[[[106.25506095198274,-5.8107171449231476],[106.25533187208609,-5.8107165430380805],[106.25533127105071,-5.8104452171276204],[106.25506035107699,-5.8104458189843955],[106.25506095198274,-5.8107171449231476]]]},"properties":{"OBJECTID":3,"Id":3,"gridcode":5,"Shape_Length":119.99999999627471,"Shape_Area":899.99999994412065}},{"type":"Feature","id":4,"geometry":{"type":"Polygon","coordinates":[[[106.29407314996951,-5.810629136801027],[106.29407253039777,-5.810357814998917],[106.29380161456842,-5.8103584354194853],[106.29380223401053,-5.8106297572507586],[106.29407314996951,-5.810629136801027]]]},"properties":{"OBJECTID":4,"Id":4,"gridcode":5,"Shape_Length":119.99999999627471,"Shape_Area":899.99999994412065}},{"type":"Feature","id":5,"geometry":{"type":"Polygon","coordinates":[[[106.29434406589903,-5.8106285162214757],[106.29434344619766,-5.8103571944485362],[106.29407253039777,-5.810357814998917],[106.29407314996951,-5.810629136801027],[106.29434406589903,-5.8106285162214757]]]},"properties":{"OBJECTID":5,"Id":5,"gridcode":4,"Shape_Length":119.99999999254942,"Shape_Area":899.99999988824129}},{"type":"Feature","id":6,"geometry":{"type":"Polygon","coordinates":[[[106.2547906326555,-5.810989072642764],[106.25479003185085,-5.8107177466783861],[106.25451911169043,-5.8107183483037987],[106.25451971236545,-5.8109896742964544],[106.2547906326555,-5.810989072642764]]]},"properties":{"OBJECTID":6,"Id":6,"gridcode":5,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":7,"geometry":{"type":"Polygon","coordinates":[[[106.29461560165954,-5.8108992172532083],[106.29461498179914,-5.8106278955121091],[106.29434406589903,-5.8106285162214757],[106.29407314996951,-5.810629136801027],[106.29407376957064,-5.8109004586004698],[106.29461560165954,-5.8108992172532083]]]},"properties":{"OBJECTID":7,"Id":7,"gridcode":5,"Shape_Length":179.99999999813735,"Shape_Area":1799.9999999720603}},{"type":"Feature","id":8,"geometry":{"type":"Polygon","coordinates":[[[106.29488651765985,-5.8108985963848427],[106.29488589766983,-5.8106272746729246],[106.29461498179914,-5.8106278955121091],[106.29461560165954,-5.8108992172532083],[106.29488651765985,-5.8108985963848427]]]},"properties":{"OBJECTID":8,"Id":8,"gridcode":3,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":9,"geometry":{"type":"Polygon","coordinates":[[[106.25533307424247,-5.811259194851071],[106.25533247315001,-5.8109878689458805],[106.25506155291701,-5.8109884708592388],[106.25506215387985,-5.8112597967927195],[106.25533307424247,-5.811259194851071]]]},"properties":{"OBJECTID":9,"Id":9,"gridcode":4,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":10,"geometry":{"type":"Polygon","coordinates":[[[106.25560399457656,-5.8112585927795832],[106.25560339335446,-5.8109872669026883],[106.25533247315001,-5.8109878689458805],[106.25533307424247,-5.811259194851071],[106.25560399457656,-5.8112585927795832]]]},"properties":{"OBJECTID":10,"Id":10,"gridcode":5,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},{"type":"Feature","id":11,"geometry":{"type":"Polygon","coordinates":[[[106.25831319634607,-5.8112525649235263],[106.25831199133764,-5.8107099137337306],[106.25749923188476,-5.8107117232837533],[106.25749983398578,-5.8109830489650101],[106.25777075396164,-5.8109824458831509],[106.25777135622089,-5.8112537715334529],[106.25831319634607,-5.8112525649235263]]]},"properties":{"OBJECTID":11,"Id":11,"gridcode":2,"Shape_Length":300.00000000186265,"Shape_Area":4500.0000000558794}},{"type":"Feature","id":12,"geometry":{"type":"Polygon","coordinates":[[[106.25723011800982,-5.8115263033283124],[106.25722951598128,-5.8112549776240217],[106.25668767562733,-5.8112561831952343],[106.25668827739658,-5.8115275089561855],[106.25723011800982,-5.8115263033283124]]]},"properties":{"OBJECTID":12,"Id":12,"gridcode":5,"Shape_Length":179.99999999813735,"Shape_Area":1799.9999999720603}},{"type":"Feature","id":13,"geometry":{"type":"Polygon","coordinates":[[[106.29488775772825,-5.8114412398007529],[106.29488651765985,-5.8108985963848427],[106.29461560165954,-5.8108992172532083],[106.29461684146868,-5.8114418607274807],[106.29488775772825,-5.8114412398007529]]]},"properties":{"OBJECTID":13,"Id":13,"gridcode":5,"Shape_Length":180.00000000558794,"Shape_Area":1800.0000001117587}},{"type":"Feature","id":14,"geometry":{"type":"Polygon","coordinates":[[[106.25804348116137,-5.8117958195292392],[106.25804287871526,-5.8115244939126631],[106.25777195850873,-5.8115250971810584],[106.25777256082517,-5.811796422825986],[106.25804348116137,-5.8117958195292392]]]},"properties":{"OBJECTID":14,"Id":14,"gridcode":4,"Shape_Length":119.99999999441206,"Shape_Area":899.99999991618097}},{"type":"Feature","id":15,"geometry":{"type":"Polygon","coordinates":[[[106.25831440146895,-5.8117952161026416],[106.25831379889321,-5.8115238905144233],[106.25804287871526,-5.8115244939126631],[106.25804348116137,-5.8117958195292392],[106.25831440146895,-5.8117952161026416]]]},"properties":{"OBJECTID":15,"Id":15,"gridcode":5,"Shape_Length":119.99999999627471,"Shape_Area":899.99999994412065}},{"type":"Feature","id":16,"geometry":{"type":"Polygon","coordinates":[[[106.25939808241316,-5.8117928010977371],[106.25939747931881,-5.8115214756230102],[106.26021023933733,-5.8115196630910786],[106.26021084282065,-5.811790988480622],[106.26048176289916,-5.8117903840152154],[106.2604811592862,-5.8115190586540786],[106.26075207920641,-5.811518454087234],[106.26075147549246,-5.8112471287518304],[106.26048055570188,-5.8112477332902621],[106.26047995214623,-5.81097640792375],[106.26075087180716,-5.8109758034137302],[106.26075026815053,-5.8107044780730197],[106.2599375094707,-5.8107062911283611],[106.25993811273842,-5.8109776165542923],[106.2585835137176,-5.8109806358585754],[106.25858291109805,-5.8107093102907363],[106.25885383082984,-5.8107087067179144],[106.25885322810927,-5.8104373811757828],[106.25831138887634,-5.8104385881348666],[106.25533127105071,-5.8104452171276204],[106.25533187208609,-5.8107165430380805],[106.25506095198274,-5.8107171449231476],[106.25479003185085,-5.8107177466783861],[106.2547906326555,-5.810989072642764],[106.25506155291701,-5.8109884708592388],[106.25533247315001,-5.8109878689458805],[106.25560339335446,-5.8109872669026883],[106.25560399457656,-5.8112585927795832],[106.25668767562733,-5.8112561831952343],[106.25722951598128,-5.8112549776240217],[106.25723011800982,-5.8115263033283124],[106.25777195850873,-5.8115250971810584],[106.25804287871526,-5.8115244939126631],[106.25831379889321,-5.8115238905144233],[106.25831440146895,-5.8117952161026416],[106.25858532174794,-5.8117946125461923],[106.25885624199832,-5.8117940088598914],[106.25912716222005,-5.8117934050437396],[106.25939808241316,-5.8117928010977371]],[[106.25831319634607,-5.8112525649235263],[106.25777135622089,-5.8112537715334529],[106.25777075396164,-5.8109824458831509],[106.25749983398578,-5.8109830489650101],[106.25749923188476,-5.8107117232837533],[106.25831199133764,-5.8107099137337306],[106.25831319634607,-5.8112525649235263]]]},"properties":{"OBJECTID":16,"Id":16,"gridcode":1,"Shape_Length":2159.9999999962747,"Shape_Area":54899.999999944121}},{"type":"Feature","id":17,"geometry":{"type":"Polygon","coordinates":[[[106.29488837780661,-5.8117125615046756],[106.29488775772825,-5.8114412398007529],[106.29461684146868,-5.8114418607274807],[106.29461746141739,-5.8117131824605854],[106.29488837780661,-5.8117125615046756]]]},"properties":{"OBJECTID":17,"Id":17,"gridcode":4,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":18,"geometry":{"type":"Polygon","coordinates":[[[106.25858532174794,-5.8117946125461923],[106.25858592448198,-5.8120659381034185],[106.258856844862,-5.8120653343887492],[106.25885624199832,-5.8117940088598914],[106.25858532174794,-5.8117946125461923]]]},"properties":{"OBJECTID":18,"Id":18,"gridcode":3,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":19,"geometry":{"type":"Polygon","coordinates":[[[106.25912716222005,-5.8117934050437396],[106.25912776521339,-5.8120647305442201],[106.25939868553615,-5.8120641265698358],[106.25939808241316,-5.8117928010977371],[106.25912716222005,-5.8117934050437396]]]},"properties":{"OBJECTID":19,"Id":19,"gridcode":5,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":20,"geometry":{"type":"Polygon","coordinates":[[[106.2645461662207,-5.8120526263837426],[106.26454556063419,-5.8117813014520632],[106.26373280160409,-5.811783120301997],[106.26373340680163,-5.8120544453191521],[106.2645461662207,-5.8120526263837426]]]},"properties":{"OBJECTID":20,"Id":20,"gridcode":5,"Shape_Length":240.00000000372529,"Shape_Area":2700.0000001676381}},{"type":"Feature","id":21,"geometry":{"type":"Polygon","coordinates":[[[106.29461808139556,-5.8119845041910576],[106.29488899791443,-5.8119838832059667],[106.29488837780661,-5.8117125615046756],[106.29461746141739,-5.8117131824605854],[106.29461808139556,-5.8119845041910576]]]},"properties":{"OBJECTID":21,"Id":21,"gridcode":3,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},{"type":"Feature","id":22,"geometry":{"type":"Polygon","coordinates":[[[106.29461870140315,-5.8122558259188475],[106.29461808139556,-5.8119845041910576],[106.29461746141739,-5.8117131824605854],[106.29434654499875,-5.8117138032866542],[106.29434778472518,-5.8122564468032669],[106.29461870140315,-5.8122558259188475]]]},"properties":{"OBJECTID":22,"Id":22,"gridcode":1,"Shape_Length":180.00000000558794,"Shape_Area":1800.0000001117587}},{"type":"Feature","id":23,"geometry":{"type":"Polygon","coordinates":[[[106.26535892538097,-5.8120508062796308],[106.26562984504353,-5.8120501993185485],[106.26563045117746,-5.8123215241334956],[106.26590137094091,-5.8123209170140306],[106.26590197723328,-5.8125922417977858],[106.26644381693313,-5.8125910271121919],[106.26644321038141,-5.8123197023855129],[106.26617229067556,-5.8123203097647025],[106.2661716842823,-5.8120489850068182],[106.26590076467731,-5.812049592227611],[106.26589955223648,-5.8115069426467851],[106.26535771345876,-5.8115081565847033],[106.26535892538097,-5.8120508062796308]]]},"properties":{"OBJECTID":23,"Id":23,"gridcode":1,"Shape_Length":480,"Shape_Area":7200}},{"type":"Feature","id":24,"geometry":{"type":"Polygon","coordinates":[[[106.29434778472518,-5.8122564468032669],[106.29434840463256,-5.8125277685575663],[106.29461932144018,-5.8125271476439719],[106.29461870140315,-5.8122558259188475],[106.29434778472518,-5.8122564468032669]]]},"properties":{"OBJECTID":24,"Id":24,"gridcode":4,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":25,"geometry":{"type":"Polygon","coordinates":[[[106.26319338203226,-5.8128696324997451],[106.26319277700786,-5.8125983074336744],[106.26292185682723,-5.8125989132829874],[106.26292246172196,-5.8128702383775259],[106.26319338203226,-5.8128696324997451]]]},"properties":{"OBJECTID":25,"Id":25,"gridcode":4,"Shape_Length":119.99999999441206,"Shape_Area":899.99999991618097}},{"type":"Feature","id":26,"geometry":{"type":"Polygon","coordinates":[[[106.26427706298617,-5.8128672076898749],[106.26427645744305,-5.8125958827377362],[106.26319277700786,-5.8125983074336744],[106.26319338203226,-5.8128696324997451],[106.26427706298617,-5.8128672076898749]]]},"properties":{"OBJECTID":26,"Id":26,"gridcode":5,"Shape_Length":299.99999999627471,"Shape_Area":3599.9999997764826}},{"type":"Feature","id":27,"geometry":{"type":"Polygon","coordinates":[[[106.26536074348009,-5.8128647808020171],[106.26535953138523,-5.8123221311230999],[106.2648176917145,-5.8123233447127243],[106.26481708596955,-5.8120520198122279],[106.2645461662207,-5.8120526263837426],[106.26373340680163,-5.8120544453191521],[106.26373280160409,-5.811783120301997],[106.26346188186992,-5.8117837263256078],[106.26346127683075,-5.8115124012773443],[106.2631903571975,-5.8115130071426311],[106.26318975231672,-5.8112416820632147],[106.26129331498755,-5.81124591928545],[106.26129391896082,-5.8115172445640102],[106.26102299909796,-5.8115178493905448],[106.26102420687121,-5.8120604999965293],[106.26129512699336,-5.8120598951131459],[106.26129573105267,-5.8123312203837196],[106.26210849163608,-5.8123294048691188],[106.26210788718781,-5.8120580796838555],[106.26237880719522,-5.8120574742810458],[106.26237820264596,-5.811786149121553],[106.26264912249503,-5.8117855436173418],[106.26264851784484,-5.8115142184836746],[106.26291943753553,-5.8115136128780751],[106.26292004231539,-5.8117849379832807],[106.26264912249503,-5.8117855436173418],[106.26264972717395,-5.8120568687483791],[106.26237880719522,-5.8120574742810458],[106.26238001637985,-5.8126001245920103],[106.26292185682723,-5.8125989132829874],[106.26319277700786,-5.8125983074336744],[106.26427645744305,-5.8125958827377362],[106.26427706298617,-5.8128672076898749],[106.26536074348009,-5.8128647808020171]]]},"properties":{"OBJECTID":27,"Id":27,"gridcode":1,"Shape_Length":1619.9999999944121,"Shape_Area":45899.999999748543}},{"type":"Feature","id":28,"geometry":{"type":"Polygon","coordinates":[[[106.26752810308645,-5.8128599207923575],[106.26752688891683,-5.8123172715701417],[106.26698504970676,-5.8123184872375493],[106.26698565651782,-5.8125898119071291],[106.26725657626692,-5.8125892041097966],[106.26725718323647,-5.8128605287481214],[106.26752810308645,-5.8128599207923575]]]},"properties":{"OBJECTID":28,"Id":28,"gridcode":1,"Shape_Length":239.99999999254942,"Shape_Area":2699.9999998882413}},{"type":"Feature","id":29,"geometry":{"type":"Polygon","coordinates":[[[106.26536134957067,-5.8131361056375317],[106.26536074348009,-5.8128647808020171],[106.26427706298617,-5.8128672076898749],[106.26427766855801,-5.8131385326394183],[106.26536134957067,-5.8131361056375317]]]},"properties":{"OBJECTID":29,"Id":29,"gridcode":5,"Shape_Length":300.00000000372529,"Shape_Area":3600.0000002235174}},{"type":"Feature","id":30,"geometry":{"type":"Polygon","coordinates":[[[106.26563226975192,-5.8131354985623602],[106.26563166353166,-5.8128641737553686],[106.26536074348009,-5.8128647808020171],[106.26536134957067,-5.8131361056375317],[106.26563226975192,-5.8131354985623602]]]},"properties":{"OBJECTID":30,"Id":30,"gridcode":1,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},{"type":"Feature","id":31,"geometry":{"type":"Polygon","coordinates":[[[106.26617411002808,-5.813134284022377],[106.26644503012297,-5.8131336765575643],[106.26644442351366,-5.8128623518361762],[106.26617350354844,-5.8128629592724481],[106.26617411002808,-5.813134284022377]]]},"properties":{"OBJECTID":31,"Id":31,"gridcode":1,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":32,"geometry":{"type":"Polygon","coordinates":[[[106.26861238984488,-5.8131288121634039],[106.26861178219811,-5.8128574876705619],[106.26834086246343,-5.8128580961458214],[106.26834146998054,-5.8131294206672512],[106.26861238984488,-5.8131288121634039]]]},"properties":{"OBJECTID":32,"Id":32,"gridcode":1,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},{"type":"Feature","id":33,"geometry":{"type":"Polygon","coordinates":[[[106.26752931737136,-5.8134025700039871],[106.26752871021449,-5.8131312453995205],[106.26725779023482,-5.813131853383851],[106.26725839726201,-5.8134031780168813],[106.26752931737136,-5.8134025700039871]]]},"properties":{"OBJECTID":33,"Id":33,"gridcode":4,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":34,"geometry":{"type":"Polygon","coordinates":[[[106.26942575732946,-5.8133983102769218],[106.26942454122896,-5.8128556614655471],[106.26915362158087,-5.8128562703304256],[106.269154229487,-5.8131275947660699],[106.26861238984488,-5.8131288121634039],[106.26861299752049,-5.8134001366535477],[106.26942575732946,-5.8133983102769218]]]},"properties":{"OBJECTID":34,"Id":34,"gridcode":1,"Shape_Length":300.00000000186265,"Shape_Area":3600.0000000279397}},{"type":"Feature","id":35,"geometry":{"type":"Polygon","coordinates":[[[106.29435026453126,-5.8133417338044699],[106.29462118172792,-5.8133411128033492],[106.29461994150667,-5.8127984693663972],[106.29434902456936,-5.8127990903091664],[106.29435026453126,-5.8133417338044699]]]},"properties":{"OBJECTID":35,"Id":35,"gridcode":3,"Shape_Length":180.00000000558794,"Shape_Area":1800.0000001117587}},{"type":"Feature","id":36,"geometry":{"type":"Polygon","coordinates":[[[106.2940799672006,-5.8136136764485],[106.29435088455635,-5.813613055548088],[106.29435026453126,-5.8133417338044699],[106.2940793473052,-5.8133423546757106],[106.2940799672006,-5.8136136764485]]]},"properties":{"OBJECTID":36,"Id":36,"gridcode":5,"Shape_Length":119.99999999254942,"Shape_Area":899.99999988824129}},{"type":"Feature","id":37,"geometry":{"type":"Polygon","coordinates":[[[106.27078218274643,-5.8142092364858167],[106.27078157394662,-5.8139379122325661],[106.27051065392415,-5.8139385218613624],[106.27051126259425,-5.8142098461432514],[106.27078218274643,-5.8142092364858167]]]},"properties":{"OBJECTID":37,"Id":37,"gridcode":3,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},{"type":"Feature","id":38,"geometry":{"type":"Polygon","coordinates":[[[106.27105310286973,-5.8142086266984787],[106.2710524939402,-5.8139373024738745],[106.27078157394662,-5.8139379122325661],[106.27078218274643,-5.8142092364858167],[106.27105310286973,-5.8142086266984787]]]},"properties":{"OBJECTID":38,"Id":38,"gridcode":4,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},{"type":"Feature","id":39,"geometry":{"type":"Polygon","coordinates":[[[106.27186586306613,-5.8142067965570483],[106.27186525374749,-5.8139354724184145],[106.27132341390487,-5.813936692585286],[106.27132280487456,-5.813665368386717],[106.27023912536127,-5.8136678070471275],[106.27023851687865,-5.8133964827313305],[106.26942575732946,-5.8133983102769218],[106.26861299752049,-5.8134001366535477],[106.26861238984488,-5.8131288121634039],[106.26834146998054,-5.8131294206672512],[106.26834086246343,-5.8128580961458214],[106.26752810308645,-5.8128599207923575],[106.26725718323647,-5.8128605287481214],[106.26725657626692,-5.8125892041097966],[106.26698565651782,-5.8125898119071291],[106.26698504970676,-5.8123184872375493],[106.26644321038141,-5.8123197023855129],[106.26644381693313,-5.8125910271121919],[106.26590197723328,-5.8125922417977858],[106.26590137094091,-5.8123209170140306],[106.26563045117746,-5.8123215241334956],[106.26562984504353,-5.8120501993185485],[106.26535892538097,-5.8120508062796308],[106.26481708596955,-5.8120520198122279],[106.2648176917145,-5.8123233447127243],[106.26535953138523,-5.8123221311230999],[106.26536074348009,-5.8128647808020171],[106.26563166353166,-5.8128641737553686],[106.26563226975192,-5.8131354985623602],[106.26617411002808,-5.813134284022377],[106.26617350354844,-5.8128629592724481],[106.26644442351366,-5.8128623518361762],[106.26698626335768,-5.8128611365740142],[106.26698687022638,-5.8131324612383022],[106.26725779023482,-5.813131853383851],[106.26752871021449,-5.8131312453995205],[106.26752931737136,-5.8134025700039871],[106.26807115750361,-5.8134013535885378],[106.26807176494869,-5.8136726781331767],[106.26942636542302,-5.8136696346785817],[106.26942697354542,-5.8139409590775744],[106.27051065392415,-5.8139385218613624],[106.27078157394662,-5.8139379122325661],[106.2710524939402,-5.8139373024738745],[106.27105310286973,-5.8142086266984787],[106.27132402296408,-5.8142080167812384],[106.27159494302957,-5.814207406734095],[106.27186586306613,-5.8142067965570483]]]},"properties":{"OBJECTID":39,"Id":39,"gridcode":5,"Shape_Length":2160.0000000037253,"Shape_Area":38699.999999664724}},{"type":"Feature","id":40,"geometry":{"type":"Polygon","coordinates":[[[106.29381028943513,-5.8141569408149794],[106.29380966961057,-5.8138856190183104],[106.29408058712545,-5.8138849982186214],[106.2940799672006,-5.8136136764485],[106.2935381324008,-5.8136149178596668],[106.29353875206625,-5.8138862396881086],[106.29326783449254,-5.813886860228016],[106.2932684540577,-5.8141581820829948],[106.29353937176111,-5.8141575615139356],[106.29381028943513,-5.8141569408149794]]]},"properties":{"OBJECTID":40,"Id":40,"gridcode":1,"Shape_Length":300.00000000186265,"Shape_Area":3600.0000001117587}},{"type":"Feature","id":41,"geometry":{"type":"Polygon","coordinates":[[[106.29381028943513,-5.8141569408149794],[106.2940812070797,-5.8141563199861279],[106.29408058712545,-5.8138849982186214],[106.29380966961057,-5.8138856190183104],[106.29381028943513,-5.8141569408149794]]]},"properties":{"OBJECTID":41,"Id":41,"gridcode":4,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":42,"geometry":{"type":"Polygon","coordinates":[[[106.2715955522474,-5.8144787308986929],[106.27159494302957,-5.814207406734095],[106.27132402296408,-5.8142080167812384],[106.27132463205221,-5.8144793409744926],[106.2715955522474,-5.8144787308986929]]]},"properties":{"OBJECTID":42,"Id":42,"gridcode":3,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":43,"geometry":{"type":"Polygon","coordinates":[[[106.27186647241368,-5.8144781206929839],[106.27186586306613,-5.8142067965570483],[106.27159494302957,-5.814207406734095],[106.2715955522474,-5.8144787308986929],[106.27186647241368,-5.8144781206929839]]]},"properties":{"OBJECTID":43,"Id":43,"gridcode":4,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":44,"geometry":{"type":"Polygon","coordinates":[[[106.27186647241368,-5.8144781206929839],[106.27267923273894,-5.8144762892964019],[106.27267862300224,-5.8142049652464918],[106.27186586306613,-5.8142067965570483],[106.27186647241368,-5.8144781206929839]]]},"properties":{"OBJECTID":44,"Id":44,"gridcode":5,"Shape_Length":240,"Shape_Area":2700}},{"type":"Feature","id":45,"geometry":{"type":"Polygon","coordinates":[[[106.29353999148537,-5.8144288833370616],[106.29353937176111,-5.8141575615139356],[106.2932684540577,-5.8141581820829948],[106.29299753632488,-5.8141588025221536],[106.29299815578973,-5.8144301244035761],[106.29353999148537,-5.8144288833370616]]]},"properties":{"OBJECTID":45,"Id":45,"gridcode":5,"Shape_Length":179.99999999813735,"Shape_Area":1799.9999999720603}},{"type":"Feature","id":46,"geometry":{"type":"Polygon","coordinates":[[[106.29381090928911,-5.8144282626089483],[106.29381028943513,-5.8141569408149794],[106.29353937176111,-5.8141575615139356],[106.29353999148537,-5.8144288833370616],[106.29381090928911,-5.8144282626089483]]]},"properties":{"OBJECTID":46,"Id":46,"gridcode":4,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":47,"geometry":{"type":"Polygon","coordinates":[[[106.27403444311635,-5.8147445582743229],[106.27403383270213,-5.8144732343705918],[106.27295015278948,-5.8144756785710578],[106.27295076268481,-5.8147470025895984],[106.27403444311635,-5.8147445582743229]]]},"properties":{"OBJECTID":47,"Id":47,"gridcode":5,"Shape_Length":299.99999999627471,"Shape_Area":3599.9999997764826}},{"type":"Feature","id":48,"geometry":{"type":"Polygon","coordinates":[[[106.27457628315831,-5.8147433353371971],[106.27457567248466,-5.8144720114909081],[106.27403383270213,-5.8144732343705918],[106.27403444311635,-5.8147445582743229],[106.27457628315831,-5.8147433353371971]]]},"properties":{"OBJECTID":48,"Id":48,"gridcode":1,"Shape_Length":179.99999999441206,"Shape_Area":1799.9999998603016}},{"type":"Feature","id":49,"geometry":{"type":"Polygon","coordinates":[[[106.29272785726234,-5.8147020666498568],[106.29272723789779,-5.814430744741979],[106.29218540202575,-5.8144319850290715],[106.29218478295,-5.8141606630602505],[106.29164294721984,-5.8141619027694933],[106.29164356603617,-5.8144332247965496],[106.29191448404565,-5.814432604977763],[106.29191510302107,-5.8147039269730207],[106.29272785726234,-5.8147020666498568]]]},"properties":{"OBJECTID":49,"Id":49,"gridcode":1,"Shape_Length":359.99999999627471,"Shape_Area":4499.9999998323619}},{"type":"Feature","id":50,"geometry":{"type":"Polygon","coordinates":[[[106.29272785726234,-5.8147020666498568],[106.29299877528399,-5.8147014462823146],[106.29299815578973,-5.8144301244035761],[106.29272723789779,-5.814430744741979],[106.29272785726234,-5.8147020666498568]]]},"properties":{"OBJECTID":50,"Id":50,"gridcode":5,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":51,"geometry":{"type":"Polygon","coordinates":[[[106.29353999148537,-5.8144288833370616],[106.29354061123907,-5.8147002051575036],[106.2938115291725,-5.814699584400234],[106.29381090928911,-5.8144282626089483],[106.29353999148537,-5.8144288833370616]]]},"properties":{"OBJECTID":51,"Id":51,"gridcode":1,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":52,"geometry":{"type":"Polygon","coordinates":[[[106.27457689386094,-5.8150146591808536],[106.27457628315831,-5.8147433353371971],[106.27403444311635,-5.8147445582743229],[106.27403505355954,-5.8150158821754214],[106.27457689386094,-5.8150146591808536]]]},"properties":{"OBJECTID":52,"Id":52,"gridcode":4,"Shape_Length":180.00000000186265,"Shape_Area":1800.000000083819}},{"type":"Feature","id":53,"geometry":{"type":"Polygon","coordinates":[[[106.27511873404644,-5.8150134356666046],[106.27511812308435,-5.8147421118804141],[106.27457628315831,-5.8147433353371971],[106.27457689386094,-5.8150146591808536],[106.27511873404644,-5.8150134356666046]]]},"properties":{"OBJECTID":53,"Id":53,"gridcode":5,"Shape_Length":180.00000000745058,"Shape_Area":1800.0000001676381}},{"type":"Feature","id":54,"geometry":{"type":"Polygon","coordinates":[[[106.27566057411593,-5.8150122116326735],[106.27565996289442,-5.8147408879039757],[106.27511812308435,-5.8147421118804141],[106.27511873404644,-5.8150134356666046],[106.27566057411593,-5.8150122116326735]]]},"properties":{"OBJECTID":54,"Id":54,"gridcode":1,"Shape_Length":180.00000000186265,"Shape_Area":1800.000000083819}},{"type":"Feature","id":55,"geometry":{"type":"Polygon","coordinates":[[[106.27566057411593,-5.8150122116326735],[106.27566118536647,-5.8152835353586934],[106.27593210548744,-5.815282923118092],[106.27593149410718,-5.8150115994208287],[106.27566057411593,-5.8150122116326735]]]},"properties":{"OBJECTID":55,"Id":55,"gridcode":5,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":56,"geometry":{"type":"Polygon","coordinates":[[[106.27999590381695,-5.8152737239179793],[106.27999529049076,-5.8150024006527659],[106.27891161209462,-5.815004856515813],[106.2789122249019,-5.8152761798963732],[106.27999590381695,-5.8152737239179793]]]},"properties":{"OBJECTID":56,"Id":56,"gridcode":1,"Shape_Length":300,"Shape_Area":3600}},{"type":"Feature","id":57,"geometry":{"type":"Polygon","coordinates":[[[106.29001929352692,-5.8149795853765172],[106.29001991165302,-5.8152509075701335],[106.2905617487732,-5.8152496691870184],[106.29056113038766,-5.8149783470515635],[106.29137388545867,-5.8149764885897621],[106.29137326671331,-5.8147051665389133],[106.29164418488186,-5.8147045468209226],[106.29164356603617,-5.8144332247965496],[106.29110172992912,-5.8144344640444112],[106.29110234851539,-5.8147057861269955],[106.2902895937455,-5.8147076441117784],[106.29029021197198,-5.8149789662789999],[106.29001929352692,-5.8149795853765172]]]},"properties":{"OBJECTID":57,"Id":57,"gridcode":1,"Shape_Length":539.99999999813735,"Shape_Area":7200}},{"type":"Feature","id":58,"geometry":{"type":"Polygon","coordinates":[[[106.29191634106002,-5.8152465709555878],[106.29218725942928,-5.8152459509195342],[106.29218664026538,-5.8149746289587148],[106.29191572202585,-5.8149752489656468],[106.29191634106002,-5.8152465709555878]]]},"properties":{"OBJECTID":58,"Id":58,"gridcode":3,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":59,"geometry":{"type":"Polygon","coordinates":[[[106.29245755847553,-5.8149740088218653],[106.29245817776913,-5.8152453307535605],[106.29272909607963,-5.8152447104576623],[106.29272847665628,-5.814973388555102],[106.29245755847553,-5.8149740088218653]]]},"properties":{"OBJECTID":59,"Id":59,"gridcode":1,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":60,"geometry":{"type":"Polygon","coordinates":[[[106.27647455731108,-5.8155530218841838],[106.27647394564234,-5.8152816982471141],[106.27620302557939,-5.8152823107475662],[106.2762036371184,-5.8155536344134031],[106.27647455731108,-5.8155530218841838]]]},"properties":{"OBJECTID":60,"Id":60,"gridcode":3,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":61,"geometry":{"type":"Polygon","coordinates":[[[106.27647455731108,-5.8155530218841838],[106.27674547747475,-5.8155524092250319],[106.27674486567626,-5.8152810856167347],[106.27647394564234,-5.8152816982471141],[106.27647455731108,-5.8155530218841838]]]},"properties":{"OBJECTID":61,"Id":61,"gridcode":4,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":62,"geometry":{"type":"Polygon","coordinates":[[[106.27728731771494,-5.8155511835169333],[106.27728670565698,-5.8152798599661981],[106.27701578568114,-5.81528047285643],[106.27701639760936,-5.8155517964359484],[106.27728731771494,-5.8155511835169333]]]},"properties":{"OBJECTID":62,"Id":62,"gridcode":5,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":63,"geometry":{"type":"Polygon","coordinates":[[[106.27864191780702,-5.8155481169728755],[106.27864130510041,-5.8152767935661593],[106.27837038526985,-5.8152774071060174],[106.27837099784674,-5.8155487305415496],[106.27864191780702,-5.8155481169728755]]]},"properties":{"OBJECTID":63,"Id":63,"gridcode":4,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":64,"geometry":{"type":"Polygon","coordinates":[[[106.28053774309987,-5.8152724951492312],[106.28053835671463,-5.8155438183540671],[106.28080927644217,-5.8155432037459391],[106.28080866269767,-5.815271880569969],[106.28053774309987,-5.8152724951492312]]]},"properties":{"OBJECTID":64,"Id":64,"gridcode":1,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":65,"geometry":{"type":"Polygon","coordinates":[[[106.28839501696564,-5.8155259419666221],[106.28839439958863,-5.8152546196013324],[106.28974899304892,-5.815251526566807],[106.28974837505254,-5.8149802043441188],[106.28812286359064,-5.8149839154214771],[106.28812348080865,-5.8152552378184685],[106.28812409805596,-5.8155265602127928],[106.28839501696564,-5.8155259419666221]]]},"properties":{"OBJECTID":65,"Id":65,"gridcode":1,"Shape_Length":479.99999999813735,"Shape_Area":6299.9999999441206}},{"type":"Feature","id":66,"geometry":{"type":"Polygon","coordinates":[[[106.29137512303747,-5.8155191326834252],[106.29137450423337,-5.8152478106379277],[106.29083266728929,-5.8152490498005767],[106.29083328583391,-5.8155203719042747],[106.29110420445036,-5.8155197523588145],[106.29137512303747,-5.8155191326834252]]]},"properties":{"OBJECTID":66,"Id":66,"gridcode":4,"Shape_Length":179.99999999813735,"Shape_Area":1799.9999999720603}},{"type":"Feature","id":67,"geometry":{"type":"Polygon","coordinates":[[[106.29137512303747,-5.8155191326834252],[106.29164604159519,-5.8155185128781079],[106.29164542266139,-5.8152471908617187],[106.29137450423337,-5.8152478106379277],[106.29137512303747,-5.8155191326834252]]]},"properties":{"OBJECTID":67,"Id":67,"gridcode":3,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":68,"geometry":{"type":"Polygon","coordinates":[[[106.27701639760936,-5.8155517964359484],[106.27701700956662,-5.8158231200127855],[106.27728792980193,-5.8158225070649845],[106.27728731771494,-5.8155511835169333],[106.27701639760936,-5.8155517964359484]]]},"properties":{"OBJECTID":68,"Id":68,"gridcode":3,"Shape_Length":119.99999999441206,"Shape_Area":899.99999991618097}},{"type":"Feature","id":69,"geometry":{"type":"Polygon","coordinates":[[[106.27864253054273,-5.8158194403769086],[106.27864191780702,-5.8155481169728755],[106.27837099784674,-5.8155487305415496],[106.27837161045269,-5.8158200539743987],[106.27864253054273,-5.8158194403769086]]]},"properties":{"OBJECTID":69,"Id":69,"gridcode":3,"Shape_Length":119.99999999627471,"Shape_Area":899.99999994412065}},{"type":"Feature","id":70,"geometry":{"type":"Polygon","coordinates":[[[106.27945529063835,-5.8158175988048111],[106.27945467751343,-5.8155462754872591],[106.27864191780702,-5.8155481169728755],[106.27864253054273,-5.8158194403769086],[106.2789134506037,-5.8158188266494806],[106.27945529063835,-5.8158175988048111]]]},"properties":{"OBJECTID":70,"Id":70,"gridcode":4,"Shape_Length":239.99999999627471,"Shape_Area":2699.9999998323619}},{"type":"Feature","id":71,"geometry":{"type":"Polygon","coordinates":[[[106.28216448906511,-5.8158114517852182],[106.28216387464279,-5.815540128756342],[106.28135111580983,-5.8155419741398937],[106.28135172984292,-5.8158132972554357],[106.28216448906511,-5.8158114517852182]]]},"properties":{"OBJECTID":71,"Id":71,"gridcode":1,"Shape_Length":240,"Shape_Area":2699.9999998882413}},{"type":"Feature","id":72,"geometry":{"type":"Polygon","coordinates":[[[106.28758226014867,-5.8155277963153473],[106.2873113411511,-5.8155284141717312],[106.28731195803847,-5.8157997366504421],[106.28758287716578,-5.8157991187650415],[106.28758226014867,-5.8155277963153473]]]},"properties":{"OBJECTID":72,"Id":72,"gridcode":4,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":73,"geometry":{"type":"Polygon","coordinates":[[[106.28839563437198,-5.8157972643292277],[106.28839501696564,-5.8155259419666221],[106.28812409805596,-5.8155265602127928],[106.28812348080865,-5.8152552378184685],[106.28758164316083,-5.8152564738629708],[106.28758226014867,-5.8155277963153473],[106.28785317911695,-5.8155271783290354],[106.2878537962638,-5.8157985007497057],[106.28812471533254,-5.8157978826044339],[106.28839563437198,-5.8157972643292277]]]},"properties":{"OBJECTID":73,"Id":73,"gridcode":5,"Shape_Length":299.99999999627471,"Shape_Area":3599.9999998882413}},{"type":"Feature","id":74,"geometry":{"type":"Polygon","coordinates":[[[106.28866655338211,-5.8157966459240846],[106.28866593584605,-5.8155253235905215],[106.28839501696564,-5.8155259419666221],[106.28839563437198,-5.8157972643292277],[106.28866655338211,-5.8157966459240846]]]},"properties":{"OBJECTID":74,"Id":74,"gridcode":4,"Shape_Length":119.99999999627471,"Shape_Area":899.99999994412065}},{"type":"Feature","id":75,"geometry":{"type":"Polygon","coordinates":[[[106.28893747236297,-5.8157960273890073],[106.28893685469717,-5.8155247050844912],[106.28866593584605,-5.8155253235905215],[106.28866655338211,-5.8157966459240846],[106.28893747236297,-5.8157960273890073]]]},"properties":{"OBJECTID":75,"Id":75,"gridcode":3,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":76,"geometry":{"type":"Polygon","coordinates":[[[106.28920839131452,-5.8157954087239956],[106.28920777351897,-5.8155240864485327],[106.28893685469717,-5.8155247050844912],[106.28893747236297,-5.8157960273890073],[106.28920839131452,-5.8157954087239956]]]},"properties":{"OBJECTID":76,"Id":76,"gridcode":4,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":77,"geometry":{"type":"Polygon","coordinates":[[[106.28947931023671,-5.8157947899290479],[106.28947869231143,-5.8155234676826453],[106.2897496110746,-5.815522848786828],[106.29002052980843,-5.8155222297610827],[106.29029144851295,-5.8155216106054084],[106.29056236718809,-5.815520991319806],[106.29083328583391,-5.8155203719042747],[106.29083266728929,-5.8152490498005767],[106.29137450423337,-5.8152478106379277],[106.29164542266139,-5.8152471908617187],[106.29191634106002,-5.8152465709555878],[106.29191572202585,-5.8149752489656468],[106.29218664026538,-5.8149746289587148],[106.29245755847553,-5.8149740088218653],[106.29272847665628,-5.814973388555102],[106.29272785726234,-5.8147020666498568],[106.29191510302107,-5.8147039269730207],[106.29191448404565,-5.814432604977763],[106.29164356603617,-5.8144332247965496],[106.29164418488186,-5.8147045468209226],[106.29137326671331,-5.8147051665389133],[106.29137388545867,-5.8149764885897621],[106.29056113038766,-5.8149783470515635],[106.2905617487732,-5.8152496691870184],[106.29001991165302,-5.8152509075701335],[106.29001929352692,-5.8149795853765172],[106.28974837505254,-5.8149802043441188],[106.28974899304892,-5.815251526566807],[106.28839439958863,-5.8152546196013324],[106.28839501696564,-5.8155259419666221],[106.28866593584605,-5.8155253235905215],[106.28893685469717,-5.8155247050844912],[106.28920777351897,-5.8155240864485327],[106.28920839131452,-5.8157954087239956],[106.28947931023671,-5.8157947899290479]]]},"properties":{"OBJECTID":77,"Id":77,"gridcode":5,"Shape_Length":1319.9999999962747,"Shape_Area":19800.000000223517}},{"type":"Feature","id":78,"geometry":{"type":"Polygon","coordinates":[[[106.29002114799319,-5.8157935519493478],[106.29002052980843,-5.8155222297610827],[106.2897496110746,-5.815522848786828],[106.28975022912962,-5.8157941710041658],[106.29002114799319,-5.8157935519493478]]]},"properties":{"OBJECTID":78,"Id":78,"gridcode":1,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":79,"geometry":{"type":"Polygon","coordinates":[[[106.29029206682743,-5.8157929327645963],[106.29029144851295,-5.8155216106054084],[106.29002052980843,-5.8155222297610827],[106.29002114799319,-5.8157935519493478],[106.29029206682743,-5.8157929327645963]]]},"properties":{"OBJECTID":79,"Id":79,"gridcode":3,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":80,"geometry":{"type":"Polygon","coordinates":[[[106.29029206682743,-5.8157929327645963],[106.29056298563232,-5.8157923134499088],[106.29056236718809,-5.815520991319806],[106.29029144851295,-5.8155216106054084],[106.29029206682743,-5.8157929327645963]]]},"properties":{"OBJECTID":80,"Id":80,"gridcode":2,"Shape_Length":119.99999999254942,"Shape_Area":899.99999988824129}},{"type":"Feature","id":81,"geometry":{"type":"Polygon","coordinates":[[[106.29083328583391,-5.8155203719042747],[106.29083390440788,-5.8157916940052869],[106.29110482315407,-5.81579107443073],[106.29110420445036,-5.8155197523588145],[106.29083328583391,-5.8155203719042747]]]},"properties":{"OBJECTID":81,"Id":81,"gridcode":1,"Shape_Length":119.99999999627471,"Shape_Area":899.99999994412065}},{"type":"Feature","id":82,"geometry":{"type":"Polygon","coordinates":[[[106.27864253054273,-5.8158194403769086],[106.27864314330751,-5.8160907637783099],[106.27891406349823,-5.8160901500220596],[106.2789134506037,-5.8158188266494806],[106.27864253054273,-5.8158194403769086]]]},"properties":{"OBJECTID":82,"Id":82,"gridcode":3,"Shape_Length":120.00000000558794,"Shape_Area":900.00000008381903}},{"type":"Feature","id":83,"geometry":{"type":"Polygon","coordinates":[[[106.28053958403153,-5.8160864647557426],[106.28053897035852,-5.8158151415562198],[106.28026805047215,-5.8158157560632739],[106.2802686640154,-5.8160870792916528],[106.28053958403153,-5.8160864647557426]]]},"properties":{"OBJECTID":83,"Id":83,"gridcode":3,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":84,"geometry":{"type":"Polygon","coordinates":[[[106.28108142397643,-5.8160852352940866],[106.28108081004393,-5.8158139121523007],[106.28053897035852,-5.8158151415562198],[106.28053958403153,-5.8160864647557426],[106.28108142397643,-5.8160852352940866]]]},"properties":{"OBJECTID":84,"Id":84,"gridcode":4,"Shape_Length":180.00000000558794,"Shape_Area":1800.0000001396984}},{"type":"Feature","id":85,"geometry":{"type":"Polygon","coordinates":[[[106.28297786286558,-5.8160809280850883],[106.28297724802486,-5.8158096051455672],[106.28216448906511,-5.8158114517852182],[106.28135172984292,-5.8158132972554357],[106.28135111580983,-5.8155419741398937],[106.28108019614055,-5.8155425890078822],[106.28107958226633,-5.8152712658607815],[106.28080866269767,-5.815271880569969],[106.28080927644217,-5.8155432037459391],[106.28053835671463,-5.8155438183540671],[106.28053774309987,-5.8152724951492312],[106.28026682347297,-5.8152731095985679],[106.280267436958,-5.8155444328322607],[106.27999651717226,-5.8155450471805255],[106.27999590381695,-5.8152737239179793],[106.2789122249019,-5.8152761798963732],[106.27891161209462,-5.815004856515813],[106.27809885299213,-5.815006697048946],[106.27809946541022,-5.8152780205159518],[106.27837038526985,-5.8152774071060174],[106.27864130510041,-5.8152767935661593],[106.27864191780702,-5.8155481169728755],[106.27945467751343,-5.8155462754872591],[106.27945529063835,-5.8158175988048111],[106.28026805047215,-5.8158157560632739],[106.28053897035852,-5.8158151415562198],[106.28108081004393,-5.8158139121523007],[106.28108142397643,-5.8160852352940866],[106.28135234390517,-5.8160846203683443],[106.28162326380478,-5.8160840053126588],[106.28189418367526,-5.8160833901270319],[106.28216510351659,-5.8160827748114601],[106.28243602332874,-5.816082159365946],[106.28297786286558,-5.8160809280850883]]]},"properties":{"OBJECTID":85,"Id":85,"gridcode":5,"Shape_Length":1439.9999999981374,"Shape_Area":21600}},{"type":"Feature","id":86,"geometry":{"type":"Polygon","coordinates":[[[106.28812533263842,-5.8160692049934424],[106.28812471533254,-5.8157978826044339],[106.2878537962638,-5.8157985007497057],[106.28785441343993,-5.8160698231677426],[106.28812533263842,-5.8160692049934424]]]},"properties":{"OBJECTID":86,"Id":86,"gridcode":3,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":87,"geometry":{"type":"Polygon","coordinates":[[[106.2883962518076,-5.8160685866891999],[106.28839563437198,-5.8157972643292277],[106.28812471533254,-5.8157978826044339],[106.28812533263842,-5.8160692049934424],[106.2883962518076,-5.8160685866891999]]]},"properties":{"OBJECTID":87,"Id":87,"gridcode":4,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":88,"geometry":{"type":"Polygon","coordinates":[[[106.2883962518076,-5.8160685866891999],[106.28866717094749,-5.816067968255016],[106.28866655338211,-5.8157966459240846],[106.28839563437198,-5.8157972643292277],[106.2883962518076,-5.8160685866891999]]]},"properties":{"OBJECTID":88,"Id":88,"gridcode":3,"Shape_Length":120.00000000372529,"Shape_Area":900.00000005587935}},{"type":"Feature","id":89,"geometry":{"type":"Polygon","coordinates":[[[106.28920839131452,-5.8157954087239956],[106.28920900913938,-5.8160667309968259],[106.28947992819133,-5.8160661121728188],[106.28947931023671,-5.8157947899290479],[106.28920839131452,-5.8157954087239956]]]},"properties":{"OBJECTID":89,"Id":89,"gridcode":1,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":90,"geometry":{"type":"Polygon","coordinates":[[[106.28135295799655,-5.8163559434785714],[106.28135234390517,-5.8160846203683443],[106.28108142397643,-5.8160852352940866],[106.28108203793806,-5.8163565584331893],[106.28135295799655,-5.8163559434785714]]]},"properties":{"OBJECTID":90,"Id":90,"gridcode":3,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":91,"geometry":{"type":"Polygon","coordinates":[[[106.28162387802591,-5.8163553283940033],[106.28162326380478,-5.8160840053126588],[106.28135234390517,-5.8160846203683443],[106.28135295799655,-5.8163559434785714],[106.28162387802591,-5.8163553283940033]]]},"properties":{"OBJECTID":91,"Id":91,"gridcode":4,"Shape_Length":120,"Shape_Area":900}},{"type":"Feature","id":92,"geometry":{"type":"Polygon","coordinates":[[[106.28189479802614,-5.8163547131794857],[106.28216571799723,-5.8163540978350188],[106.28216510351659,-5.8160827748114601],[106.28189418367526,-5.8160833901270319],[106.28189479802614,-5.8163547131794857]]]},"properties":{"OBJECTID":92,"Id":92,"gridcode":4,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":93,"geometry":{"type":"Polygon","coordinates":[[[106.28297847773548,-5.8163522510219261],[106.28297786286558,-5.8160809280850883],[106.28243602332874,-5.816082159365946],[106.28243663793914,-5.8163534823606033],[106.28297847773548,-5.8163522510219261]]]},"properties":{"OBJECTID":93,"Id":93,"gridcode":4,"Shape_Length":180.00000000186265,"Shape_Area":1800.0000000279397}},{"type":"Feature","id":94,"geometry":{"type":"Polygon","coordinates":[[[106.28352031741512,-5.8163510191634531],[106.28351970228572,-5.8160796962844596],[106.28324878259023,-5.8160803122497464],[106.28324939758988,-5.8163516351576634],[106.28352031741512,-5.8163510191634531]]]},"properties":{"OBJECTID":94,"Id":94,"gridcode":3,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":95,"geometry":{"type":"Polygon","coordinates":[[[106.28406215697804,-5.8163497867851843],[106.28406154158912,-5.8160784639640619],[106.28351970228572,-5.8160796962844596],[106.28352031741512,-5.8163510191634531],[106.28406215697804,-5.8163497867851843]]]},"properties":{"OBJECTID":95,"Id":95,"gridcode":5,"Shape_Length":180.00000000186265,"Shape_Area":1800.0000000279397}},{"type":"Feature","id":96,"geometry":{"type":"Polygon","coordinates":[[[106.28812533263842,-5.8160692049934424],[106.28812594997359,-5.8163405273797668],[106.28839686927252,-5.8163399090464889],[106.2883962518076,-5.8160685866891999],[106.28812533263842,-5.8160692049934424]]]},"properties":{"OBJECTID":96,"Id":96,"gridcode":1,"Shape_Length":119.99999999813735,"Shape_Area":899.99999997206032}},{"type":"Feature","id":97,"geometry":{"type":"Polygon","coordinates":[[[106.28162387802591,-5.8163553283940033],[106.28162449227619,-5.8166266514726805],[106.28189541240619,-5.8166260362292732],[106.28189479802614,-5.8163547131794857],[106.28162387802591,-5.8163553283940033]]]},"properties":{"OBJECTID":97,"Id":97,"gridcode":1,"Shape_Length":120.00000000186265,"Shape_Area":900.00000002793968}},{"type":"Feature","id":98,"geometry":{"type":"Polygon","coordinates":[[[106.28243663793914,-5.8163534823606033],[106.28243725257869,-5.8166248053525962],[106.28297909263455,-5.8166235739560967],[106.28297847773548,-5.8163522510219261],[106.28243663793914,-5.8163534823606033]]]},"properties":{"OBJECTID":98,"Id":98,"gridcode":1,"Shape_Length":180.00000000186265,"Shape_Area":1800.0000000279397}},{"type":"Feature","id":99,"geometry":{"type":"Polygon","coordinates":[[[106.28352031741512,-5.8163510191634531],[106.28352093257371,-5.8166223420397785],[106.28406277239614,-5.8166211096036413],[106.28406215697804,-5.8163497867851843],[106.28352031741512,-5.8163510191634531]]]},"properties":{"OBJECTID":99,"Id":99,"gridcode":2,"Shape_Length":180.00000000186265,"Shape_Area":1800.0000000279397}},{"type":"Feature","id":100,"geometry":{"type":"Polygon","coordinates":[[[106.28460461210176,-5.8166198766476853],[106.28460399642414,-5.8163485538871225],[106.2843330767157,-5.8163491704011285],[106.28433369226354,-5.8166204931906398],[106.28460461210176,-5.8166198766476853]]]},"properties":{"OBJECTID":100,"Id":100,"gridcode":1,"Shape_Length":120,"Shape_Area":900}}]};

    // ==================== INISIALISASI PETA ====================
    const map = L.map('map').setView([-5.810, 106.259], 14);

    // Layer Dasar
    const basemaps = {
      'osm': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }),
      'satellite': L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: '¬© Esri'
      }),
      'terrain': L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg', {
        attribution: '¬© Stamen Design'
      })
    };

    let currentBasemap = 'satellite';
    basemaps[currentBasemap].addTo(map);

    // ==================== TOGGLE CONTROLS ====================
    // Toggle Panel Kanan
    document.getElementById('togglePanelBtn').addEventListener('click', function() {
        const rightPanel = document.getElementById('rightPanel');
        rightPanel.style.display = rightPanel.style.display === 'none' ? 'block' : 'none';
    });

    // Toggle Statistics Panel
    document.getElementById('statsToggle').addEventListener('click', function() {
        const statsPanel = document.getElementById('statsPanel');
        statsPanel.style.display = statsPanel.style.display === 'none' ? 'block' : 'none';
    });

    // Close Statistics Panel
    document.getElementById('statsClose').addEventListener('click', function() {
        document.getElementById('statsPanel').style.display = 'none';
    });

    // Collapsible Sections
    document.querySelectorAll('.collapsible-header').forEach(header => {
        header.addEventListener('click', function() {
            const collapsible = this.parentElement;
            collapsible.classList.toggle('hidden');
            const arrow = this.querySelector('span:last-child');
            arrow.textContent = collapsible.classList.contains('hidden') ? '‚ñ∂' : '‚ñº';
        });
    });

    // Toggle Basemap Panel
    document.getElementById('basemapFlipBtn').addEventListener('click', function() {
        const basemapCard = document.getElementById('basemapCard');
        basemapCard.classList.toggle('hidden');
    });

    // Tutup Panel Kanan
    document.getElementById('closePanel').addEventListener('click', function() {
        document.getElementById('rightPanel').style.display = 'none';
    });

    // Pilih Basemap
    document.querySelectorAll('.basemap-item').forEach(item => {
        item.addEventListener('click', function() {
            const basemap = this.getAttribute('data-basemap');
            
            document.querySelectorAll('.basemap-item').forEach(el => {
                el.classList.remove('active');
            });
            
            this.classList.add('active');
            
            if (basemaps[currentBasemap]) {
                map.removeLayer(basemaps[currentBasemap]);
            }
            
            basemaps[basemap].addTo(map);
            currentBasemap = basemap;
            
            document.getElementById('basemapCard').classList.add('hidden');
        });
    });

    // Toolbar Controls
    document.getElementById('zoomIn').addEventListener('click', function() {
        map.zoomIn();
    });

    document.getElementById('zoomOut').addEventListener('click', function() {
        map.zoomOut();
    });

    // Chatbox Toggle
    document.getElementById('chatHeader').addEventListener('click', function() {
        const chatContent = document.getElementById('chatContent');
        const chatInputRow = document.querySelector('.chat-input-row');
        
        if (chatContent.style.display === 'none') {
            chatContent.style.display = 'flex';
            chatInputRow.style.display = 'flex';
            this.querySelector('span:last-child').textContent = '‚àí';
        } else {
            chatContent.style.display = 'none';
            chatInputRow.style.display = 'none';
            this.querySelector('span:last-child').textContent = '+';
        }
    });

    // Search Functionality
    document.getElementById('doSearch').addEventListener('click', function() {
        performSearch();
    });

    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            performSearch();
        }
    });

    function performSearch() {
        const query = document.getElementById('searchInput').value.trim();
        
        if (!query) return;
        
        // Cek jika query adalah koordinat
        const coordMatch = query.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);
        
        if (coordMatch) {
            const lat = parseFloat(coordMatch[1]);
            const lng = parseFloat(coordMatch[2]);
            
            if (!isNaN(lat) && !isNaN(lng)) {
                map.setView([lat, lng], 16);
                L.marker([lat, lng]).addTo(map)
                    .bindPopup(`Lokasi: ${lat}, ${lng}`)
                    .openPopup();
                return;
            }
        }
        
        alert('Silakan gunakan format koordinat: latitude,longitude (contoh: -5.810,106.259)');
    }

    // ==================== SISTEM INTEGRASI GEOJSON ====================
    let geoJSONLayer = null;
    let densityChart = null;
    let currentFilter = 'all';

    // Fungsi untuk memuat dan menampilkan data GeoJSON
    function loadGeoJSONData() {
        // Hapus layer sebelumnya jika ada
        if (geoJSONLayer) {
            map.removeLayer(geoJSONLayer);
        }
        
        const data = savipulautunda20;
        
        // Hitung statistik
        calculateStatistics(data);
        
        // Style berdasarkan gridcode (kerapatan vegetasi)
        function getStyleByGridcode(feature) {
            const gridcode = feature.properties.gridcode;
            let color, opacity, weight;
            
            switch(gridcode) {
                case 1: // Sangat Rendah
                    color = '#ffffcc';
                    opacity = 0.7;
                    weight = 1;
                    break;
                case 2: // Rendah
                    color = '#c2e699';
                    opacity = 0.7;
                    weight = 1;
                    break;
                case 3: // Sedang-Rendah
                    color = '#78c679';
                    opacity = 0.7;
                    weight = 1.5;
                    break;
                case 4: // Sedang
                    color = '#31a354';
                    opacity = 0.8;
                    weight = 2;
                    break;
                case 5: // Tinggi
                    color = '#006837';
                    opacity = 0.9;
                    weight = 2.5;
                    break;
                case 6: // Sangat Tinggi
                    color = '#004529';
                    opacity = 1;
                    weight = 3;
                    break;
                default:
                    color = '#808080';
                    opacity = 0.5;
                    weight = 1;
            }
            
            return {
                fillColor: color,
                color: color,
                weight: weight,
                opacity: 0.8,
                fillOpacity: opacity
            };
        }
        
        // Filter function
        function filterByDensity(feature) {
            if (currentFilter === 'all') return true;
            return feature.properties.gridcode.toString() === currentFilter;
        }
        
        // Tambah layer GeoJSON ke peta
        geoJSONLayer = L.geoJSON(data, {
            style: getStyleByGridcode,
            filter: filterByDensity,
            onEachFeature: function(feature, layer) {
                const props = feature.properties;
                
                let popupContent = `
                    <div style="max-width: 280px;">
                        <h4 style="margin:0 0 8px 0; color: #0a5c36; border-bottom: 2px solid #0a5c36; padding-bottom: 4px;">
                            Savi Pulau Tunda20 - Poligon ${props.Id}
                        </h4>
                        <div style="font-size: 12px; color: #333; line-height: 1.4;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Kerapatan:</strong> 
                                <span style="color: ${getColorByGridcode(props.gridcode)}; font-weight: bold;">
                                    ${getKerapatanLabel(props.gridcode)}
                                </span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Gridcode:</strong> <span>${props.gridcode || 'N/A'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Luasan:</strong> <span>${props.Shape_Area ? (props.Shape_Area / 10000).toFixed(2) + ' ha' : 'N/A'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Shape Length:</strong> <span>${props.Shape_Length ? props.Shape_Length.toFixed(2) + ' m' : 'N/A'}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <strong>Shape Area:</strong> <span>${props.Shape_Area ? (props.Shape_Area / 10000).toFixed(2) + ' ha' : 'N/A'}</span>
                            </div>
                        </div>
                `;
                
                // Tambahkan info tambahan berdasarkan gridcode
                popupContent += `
                    <div style="margin-top: 8px; padding: 6px; background: #f8f9fa; border-radius: 4px; font-size: 11px; border-left: 3px solid ${getColorByGridcode(props.gridcode)};">
                        <strong>Indeks Vegetasi:</strong> ${getKerapatanLabel(props.gridcode)}<br>
                        <div style="width: 100%; height: 8px; background: linear-gradient(90deg, #ffffcc, #004529); margin: 4px 0; border-radius: 4px; position: relative;">
                            <div style="position: absolute; left: ${((props.gridcode - 1) / 5) * 100}%; width: 20%; height: 100%; background: ${getColorByGridcode(props.gridcode)}; border-radius: 4px;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 9px; color: #666;">
                            <span>Sangat Rendah</span>
                            <span>Sangat Tinggi</span>
                        </div>
                    </div>
                `;
                
                popupContent += `</div>`;
                layer.bindPopup(popupContent);
                
                // Tooltip
                layer.bindTooltip(`Savi Pulau Tunda20 - ${getKerapatanLabel(props.gridcode)} (${(props.Shape_Area / 10000).toFixed(2)} ha)`, {
                    permanent: false,
                    direction: 'auto',
                    className: 'custom-tooltip'
                });
            }
        }).addTo(map);
        
        // Fit bounds ke data
        map.fitBounds(geoJSONLayer.getBounds());
        
        console.log(`Data Savi Pulau Tunda20 berhasil dimuat - ${data.features.length} fitur`);
    }

    // Fungsi untuk mendapatkan label kerapatan
    function getKerapatanLabel(gridcode) {
        switch(gridcode) {
            case 1: return "Sangat Rendah";
            case 2: return "Rendah";
            case 3: return "Sedang-Rendah";
            case 4: return "Sedang";
            case 5: return "Tinggi";
            case 6: return "Sangat Tinggi";
            default: return "Tidak Diketahui";
        }
    }

    // Fungsi untuk menghitung statistik
    function calculateStatistics(data) {
        let totalLuasan = 0;
        let jumlahPoligon = data.features.length;
        let luasanMax = 0;
        let luasanMin = Infinity;
        let kerapatanRata = 0;
        
        const densityCount = {
            1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0
        };
        
        data.features.forEach(feature => {
            const luasan = feature.properties.Shape_Area / 10000 || 0; // Convert dari m¬≤ ke ha
            const gridcode = feature.properties.gridcode || 1;
            
            totalLuasan += luasan;
            densityCount[gridcode]++;
            
            if (luasan > luasanMax) luasanMax = luasan;
            if (luasan < luasanMin) luasanMin = luasan;
            kerapatanRata += gridcode;
        });
        
        kerapatanRata = (kerapatanRata / jumlahPoligon).toFixed(1);
        
        // Update statistik panel
        document.getElementById('totalLuas').textContent = totalLuasan.toFixed(2) + ' ha';
        document.getElementById('jumlahPoligon').textContent = jumlahPoligon;
        document.getElementById('kerapatanRata').textContent = kerapatanRata;
        document.getElementById('luasMax').textContent = luasanMax.toFixed(2) + ' ha';
        document.getElementById('luasMin').textContent = luasanMin.toFixed(2) + ' ha';
        
        // Update detail kerapatan
        document.getElementById('detailSangatRendah').textContent = densityCount[1] + ' poligon';
        document.getElementById('detailRendah').textContent = densityCount[2] + ' poligon';
        document.getElementById('detailSedangRendah').textContent = densityCount[3] + ' poligon';
        document.getElementById('detailSedang').textContent = densityCount[4] + ' poligon';
        document.getElementById('detailTinggi').textContent = densityCount[5] + ' poligon';
        document.getElementById('detailSangatTinggi').textContent = densityCount[6] + ' poligon';
        
        // Update data display
        document.getElementById('dataSangatRendah').textContent = densityCount[1] + ' poligon';
        document.getElementById('dataRendah').textContent = densityCount[2] + ' poligon';
        document.getElementById('dataSedangRendah').textContent = densityCount[3] + ' poligon';
        document.getElementById('dataSedang').textContent = densityCount[4] + ' poligon';
        document.getElementById('dataTinggi').textContent = densityCount[5] + ' poligon';
        document.getElementById('dataSangatTinggi').textContent = densityCount[6] + ' poligon';
        
        // Update chart
        updateDensityChart(densityCount);
    }

    // Fungsi untuk update chart kerapatan
    function updateDensityChart(densityCount) {
        const ctx = document.getElementById('densityChart').getContext('2d');
        
        if (densityChart) {
            densityChart.destroy();
        }
        
        densityChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Sangat Rendah', 'Rendah', 'Sedang-Rendah', 'Sedang', 'Tinggi', 'Sangat Tinggi'],
                datasets: [{
                    label: 'Distribusi Kerapatan',
                    data: [
                        densityCount[1],
                        densityCount[2],
                        densityCount[3],
                        densityCount[4],
                        densityCount[5],
                        densityCount[6]
                    ],
                    backgroundColor: [
                        '#ffffcc',
                        '#c2e699',
                        '#78c679',
                        '#31a354',
                        '#006837',
                        '#004529'
                    ],
                    borderColor: [
                        '#d9d9a3',
                        '#a8c97f',
                        '#5fa85a',
                        '#298845',
                        '#005426',
                        '#003318'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12,
                            font: {
                                size: 10
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: 'Distribusi Kerapatan EVI',
                        font: {
                            size: 12
                        }
                    }
                }
            }
        });
    }

    // Fungsi untuk mendapatkan warna berdasarkan gridcode
    function getColorByGridcode(gridcode) {
        switch(gridcode) {
            case 1: return '#ffffcc';
            case 2: return '#c2e699';
            case 3: return '#78c679';
            case 4: return '#31a354';
            case 5: return '#006837';
            case 6: return '#004529';
            default: return '#808080';
        }
    }

    // Filter functionality
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Update current filter
            currentFilter = this.getAttribute('data-density');
            
            // Reload GeoJSON data with filter
            loadGeoJSONData();
        });
    });

    // Download Data GeoJSON
    document.getElementById('downloadData').addEventListener('click', function() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(savipulautunda20, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "savi_pulau_tunda20.geojson");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
        
        alert('Data GeoJSON Savi Pulau Tunda20 berhasil diunduh!');
    });

    // Screenshot functionality
    document.getElementById('screenshot').addEventListener('click', function() {
        alert('Fitur screenshot akan segera tersedia!');
    });

    // Export Report
    document.getElementById('exportReport').addEventListener('click', function() {
        alert('Fitur export laporan PDF akan segera tersedia!');
    });

    // ==================== LEGENDA DINAMIS ====================
    function updateLegend() {
        const legend = L.control({ position: 'bottomright' });
        
        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'info legend');
            div.style.background = 'white';
            div.style.padding = '10px';
            div.style.borderRadius = '5px';
            div.style.boxShadow = '0 0 10px rgba(0,0,0,0.2)';
            
            const grades = [1, 2, 3, 4, 5, 6];
            const labels = [
                'Sangat Rendah (1)',
                'Rendah (2)', 
                'Sedang-Rendah (3)',
                'Sedang (4)',
                'Tinggi (5)',
                'Sangat Tinggi (6)'
            ];
            const colors = [
                '#ffffcc', '#c2e699', '#78c679', '#31a354', '#006837', '#004529'
            ];
            
            let legendHTML = '<h4 style="margin:0 0 8px 0;">Kerapatan Savi Pulau Tunda20</h4>';
            
            for (let i = 0; i < grades.length; i++) {
                legendHTML += `
                    <div style="display: flex; align-items: center; margin: 4px 0;">
                        <div style="width: 20px; height: 15px; background: ${colors[i]}; margin-right: 8px; border: 1px solid #666;"></div>
                        <span style="font-size: 12px;">${labels[i]}</span>
                    </div>
                `;
            }
            
            div.innerHTML = legendHTML;
            return div;
        };
        
        legend.addTo(map);
    }

    // ==================== KELAS KERAPATAN ====================
    const CLASSES = [
      { id: 'very-high', label: 'Sangat Tinggi', color: '#004529' },
      { id: 'high', label: 'Tinggi', color: '#006837' },
      { id: 'medium', label: 'Sedang', color: '#31a354' },
      { id: 'low-medium', label: 'Sedang-Rendah', color: '#78c679' },
      { id: 'low', label: 'Rendah', color: '#c2e699' },
      { id: 'very-low', label: 'Sangat Rendah', color: '#ffffcc' }
    ];

    // Render Kelas
    function renderClasses() {
      const classesList = document.getElementById('classesList');
      classesList.innerHTML = '';
      
      CLASSES.forEach(cls => {
        const item = document.createElement('div');
        item.className = 'class-item';
        item.innerHTML = `
          <div class="class-color" style="background:${cls.color}"></div>
          <div class="class-label">${cls.label}</div>
          <div class="switch"><div class="knob"></div></div>
        `;
        classesList.appendChild(item);
        
        // Switch event
        const switchEl = item.querySelector('.switch');
        switchEl.addEventListener('click', function() {
          this.classList.toggle('on');
        });
        switchEl.classList.add('on');
      });
    }

    // ==================== INISIALISASI ====================
    document.addEventListener('DOMContentLoaded', function() {
        renderClasses();
        updateLegend();
        
        // Load data Savi Pulau Tunda20
        setTimeout(() => {
            loadGeoJSONData();
        }, 1000);
        
        // Scale update
        map.on('zoomend', function() {
            const zoom = map.getZoom();
            const scale = Math.round(591657550 / Math.pow(2, zoom - 1));
            document.getElementById('scaleBox').textContent = `Skala: 1:${scale.toLocaleString()}`;
        });
        map.fire('zoomend');
    });

  </script>

</body>

</html>
